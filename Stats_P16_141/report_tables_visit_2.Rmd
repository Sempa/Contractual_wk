---
title: "The incidence of dysglycaemia, dyslipidaemia and changes in body composition in HIV-infected subjects initiated on antiretroviral treatment in the Free State: A cohort study - Follow up"
author: "Dr Joseph B Sempa"
date: "`r Sys.Date()`"
output:
  html_document:
    fig_caption: yes
    toc: yes
  pdf_document:
    fig_caption: yes
    toc: yes
  word_document:
    fig_caption: yes
    toc: yes
  html_notebook:
    toc: yes
always_allow_html: true
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
knitr::opts_chunk$set(cache=TRUE)
knitr::opts_chunk$set(fig.pos = 'H')
knitr::opts_chunk$set(results = 'asis')
knitr::opts_chunk$set(echo = FALSE)
knitr::opts_chunk$set(message = FALSE)
library(tidyverse)
library(magrittr)
library(knitr)
library(kableExtra)
library(tinytex)
library(gmodels)
library(readxl)
library(gtsummary)
library(caret)
library(leaps)
library(MASS)
library(predtools)
library(randomForest)
library(mice)
library(psfmi)
```


```{r, message = FALSE, cache = TRUE, warning=FALSE, echo = FALSE, results='asis'}
# library(readr)
baseline <- read_csv("baseline_visit_Jan_2022.csv")[, -c(332:337)] %>%
  filter(!is.na(pt_id))
secondVisit <- read_csv("second_visit_Jan_2022.csv")[, -c(332:348)] %>%
  filter(!is.na(pt_id))

```

```{r, message = FALSE, cache = TRUE, warning=FALSE, echo = FALSE, results='asis'}
final_dataset <- rbind(baseline, secondVisit) %>%
  filter(!is.na(pt_id)) %>%
  mutate(group = ifelse((hiv_control == 'control' | hiv_control == 'CONTROL'), 'CONTROL', ifelse(hiv_control == 'HIV' | hiv_control == 'hiv', 'HIV', ''))) %>%
  mutate(gender = as.factor(ifelse((gender == 'N' | gender == 'M'),'M', gender))) %>%
  filter(group!='')
```
# Demographics
```{r, message = FALSE, cache = TRUE, warning=FALSE, echo = FALSE, results='asis'}
dt01 <- final_dataset %>%
  filter(visit == 1) %>%
  mutate(`age of respondents` = cut(age, breaks = c(21,30,40,50,80))) %>%
  dplyr::select(`age of respondents`, gender, group) %>%
  mutate(gender = factor(gender, labels = c('Females', 'Males'))) %>%
  tbl_strata(
    strata = gender,
    .tbl_fun =
      ~ .x %>%
      # tbl_cross(`age of respondents`, group, margin = NULL) %>%
       tbl_summary(by = group, missing = "no") %>% 
      bold_labels() %>%
      add_overall() %>%
        add_n(),
    .header = "**{strata}**, N = {n}"
  )
dt01
```

# Table 3-7: Heading= Do you suffer from or take medication for following diseases?
```{r, message = FALSE, cache = TRUE, warning=FALSE, echo = FALSE, results='asis'}
table2 <- final_dataset %>%
  filter(visit == 1) %>%
  mutate(take_meds_regularly_other = ifelse(take_meds_regularly_other=='y', 'Y', take_meds_regularly_other),
         `Take meds regularly: Hypertention` = ifelse(take_meds_regularly_Hypertention=='n' | take_meds_regularly_Hypertention=='N', 'N', take_meds_regularly_Hypertention),
         `Take meds regularly: Diabetes mellitus` = ifelse(take_meds_regularly_Diabetes_mellitus == 'n' | take_meds_regularly_Diabetes_mellitus == 'N', 'N', take_meds_regularly_Diabetes_mellitus),
         `Take meds regularly: High blood cholesterol` = ifelse((take_meds_regularly_High_blood_cholesterol == 'n' | take_meds_regularly_High_blood_cholesterol == 'N' | take_meds_regularly_High_blood_cholesterol == 'NNN'), 'N', take_meds_regularly_High_blood_cholesterol),
         `Take meds regularly: Other` = take_meds_regularly_other
         ) %>%
  # filter(!is.na(take_meds_regularly_other)) %>%
  
  dplyr::select(`Take meds regularly: Hypertention`, `Take meds regularly: Diabetes mellitus`, `Take meds regularly: High blood cholesterol`, `Take meds regularly: Other`, gender, group) %>%
  mutate(gender = factor(gender, labels = c('Females', 'Males'))) %>%
  tbl_strata(
    strata = gender,
    .tbl_fun =
      ~ .x %>%
      # tbl_cross(`age of respondents`, group, margin = NULL) %>%
       tbl_summary(by = group, missing = "no") %>% 
      bold_labels()%>%
      add_overall() %>%
        add_n(),
    .header = "**{strata}**, N = {n}"
  )
table2
```

# Table 9: give data as how many medications a subject is using...eg. 1 meds= 2
```{r, message = FALSE, cache = TRUE, warning=FALSE, echo = FALSE, results='asis'}
table3 <- final_dataset %>%
  dplyr::select(pt_id, gender, group, list_regular_meds,
  list_regular_meds1,
  list_regular_meds2,
  list_regular_meds3,
  list_regular_meds4,
  list_regular_meds5,
  list_regular_meds6,
  list_regular_meds7) %>%
  pivot_longer(cols = c(list_regular_meds,
  list_regular_meds1,
  list_regular_meds2,
  list_regular_meds3,
  list_regular_meds4,
  list_regular_meds5,
  list_regular_meds6,
  list_regular_meds7),
               names_to = 'col_num',
               values_to = 'list_regular_meds') %>%
  dplyr::select(pt_id, list_regular_meds, gender, group, ) %>%
  filter(!is.na(list_regular_meds)) %>%
  filter(list_regular_meds!='NONE') %>%
  group_by(pt_id) %>%
  mutate(`Number of meds` = max(1:length(pt_id))) %>%
  mutate(`Number of meds` = as.character(ifelse(`Number of meds`>=5, '5', `Number of meds`))) %>%
  mutate(`Number of meds` = as.character(ifelse(`Number of meds`=='5', '> = 5', `Number of meds`))) %>%
  ungroup() %>%
    dplyr::select(`Number of meds`, gender, group) %>%
  mutate(gender = factor(gender, labels = c('Females', 'Males'))) %>%
  tbl_strata(#dt12,
    strata = gender,
    .tbl_fun =
      ~ .x %>%
      # tbl_cross(`age of respondents`, group, margin = NULL) %>%
       tbl_summary(by = group, missing = "no") %>% 
      bold_labels()%>%
      add_overall() %>%
        add_n(),
    .header = "**{strata}**, N = {n}"
  ) 
table3

```

# Table 10-19: Heading= Family history of participants
we should edit this table a bit
```{r, message = FALSE, cache = TRUE, warning=FALSE, echo = FALSE, results='asis'}

table4 <- final_dataset %>%
  filter(visit == 1) %>%
  # filter(!is.na(take_meds_regularly_Hypertention)) %>%
  # filter(!is.na(take_meds_regularly_Diabetes_mellitus)) %>%
  # filter(!is.na(take_meds_regularly_High_blood_cholesterol)) %>%
  mutate(`Heart disease` = ifelse(family_history_heartdiseasespecify=='n\a', '', family_history_heartdiseasespecify),
         Stroke = ifelse(family_history_stroke=='n\a', '', family_history_stroke),
         Cancer = ifelse(family_history_cancer=='n\a', '', family_history_cancer),
         Hypertension = ifelse(family_history_HTNorHBP=='n\a', '', family_history_HTNorHBP),
         Diabetes = ifelse(family_history_diabetes=='n\a', '', family_history_diabetes)) %>%
  # filter(!is.na(take_meds_regularly_other)) %>%
  
  dplyr::select(`Heart disease`, Stroke, Cancer, Hypertension, Diabetes, gender, group) %>%
  mutate(gender = factor(gender, labels = c('Females', 'Males'))) %>%
  tbl_strata(
    strata = gender,
    .tbl_fun =
      ~ .x %>%
      # tbl_cross(`age of respondents`, group, margin = NULL) %>%
       tbl_summary(by = group, missing = "no") %>% 
      bold_labels()%>%
      add_overall() %>%
        add_n(),
    .header = "**{strata}**, N = {n}"
  )
table4
```


```{r, message = FALSE, cache = TRUE, warning=FALSE, echo = FALSE, results='asis'}
table5 <- final_dataset %>%
  filter(visit == 1) %>%
  # filter(!is.na(`1.8 Do you drink alcohol?`)) %>%
  mutate(`1.8 Do you drink alcohol?` = ifelse(`1.8 Do you drink alcohol?`=='n', 'N', ifelse(`1.8 Do you drink alcohol?`=='N/Y', '', `1.8 Do you drink alcohol?`))) %>%
  mutate(`Do you drink alcohol?` = as.factor(ifelse(`1.8 Do you drink alcohol?`=='y' | `1.8 Do you drink alcohol?`=='Y7', 'Y', ifelse(`1.8 Do you drink alcohol?`=='2', 'N', `1.8 Do you drink alcohol?`)))
         ) %>%
  mutate(`Do you use drugs?` = as.factor(ifelse(`1.9 Do you use drugs?`=='n', 'N', `1.9 Do you use drugs?`)),
         `Do you smoke tobacco?` = as.factor(`1.7 Do you smoke tobacco?`),
         `Think you eat healthy diet` = as.factor(ifelse(think_you_eat_healthy_diet=='y', 'Y', ifelse(think_you_eat_healthy_diet=='N/Y', '', think_you_eat_healthy_diet))),
         `Diagnosed with diabete when pregnant` = as.factor(ifelse(`22.  Were you ever diagnosed with diabetes during pregnancy? (females):`=='n', 'N', ifelse(`22.  Were you ever diagnosed with diabetes during pregnancy? (females):`=='N/A', '', `22.  Were you ever diagnosed with diabetes during pregnancy? (females):`)))
         
         ) %>%
  mutate(`23. How many years of your life have you spent in the city?` = ifelse(`23. How many years of your life have you spent in the city?`=='6MONTHS', '.5', `23. How many years of your life have you spent in the city?`)) %>%
  mutate(`23. How many years of your life have you spent in the city?` = ifelse(`23. How many years of your life have you spent in the city?`=='15 MONTHS', '1.25', `23. How many years of your life have you spent in the city?`)) %>%
  mutate(`23. How many years of your life have you spent in the city?` = ifelse(`23. How many years of your life have you spent in the city?`=='15 MONTHS', '1', `23. How many years of your life have you spent in the city?`)) %>%
  mutate(`Years living in bloem` = as.numeric(`23. How many years of your life have you spent in the city?`)
         ) %>%
  dplyr::select(`Do you drink alcohol?`, `Do you smoke tobacco?`, `Do you use drugs?`, `Think you eat healthy diet`, `Diagnosed with diabete when pregnant`, `Years living in bloem`, gender, group) %>%
  # mutate(gender = paste("gender", gender)) %>%
  mutate(gender = factor(gender, labels = c('Females', 'Males'))) %>%
  tbl_strata( statistic = all_continuous() ~ "{mean} ({sd})",
    strata = gender,
    .tbl_fun =
      ~ .x %>%
      # tbl_cross(`age of respondents`, group, margin = NULL) %>%
       tbl_summary(by = group, missing = "no",
            statistic = list(all_continuous() ~ "{mean} ({sd})")
            ) %>% 
      bold_labels()%>% 
      add_overall() %>%#
        add_n(),
    .header = "**{strata}**, N = {n}"
  ) %>%
  
  modify_table_body(filter, !(variable == "Do you drink alcohol?" & label == "")) %>%
  modify_table_body(filter, !(variable == "Think you eat healthy diet" & label == "")) %>%
  modify_table_body(filter, !(variable == "Diagnosed with diabete when pregnant" & label == ""))

table5

```

# Tables 40-69 and give results as number positive(no need for intensity like 1, 2 etc.)..also divided in total, Hiv, control, female, male
```{r, message = FALSE, cache = TRUE, warning=FALSE, echo = FALSE, results='asis'}
table6 <- final_dataset %>%
  filter(visit == 1) %>%
  mutate(`Difficulty concentrating` = ifelse(`difficulty concentrating` =='0' | `difficulty concentrating` =='1' | `difficulty concentrating` =='2' | `difficulty concentrating` == '3' | `difficulty concentrating` == '4' |
                                             `difficulty concentrating` == 'Y', 'Y', `difficulty concentrating`),
         `Pain` = ifelse(`pain` =='0' | `pain` =='1' | `pain` =='2' | `pain` == '3' | `pain` == '4' |
                                             `pain` == 'Y', 'Y', `pain`),
         `Lack of energy` = ifelse(`lack of energy` =='0' | `lack of energy` =='1' | `lack of energy` =='2' | `lack of energy` == '3' | `lack of energy` == '4' | `lack of energy` == 'Y', 'Y', `lack of energy`),
         `Cough` = ifelse(`cough` =='0' | `cough` =='1' | `cough` =='2' | `cough` == '3' | `cough` == '4' |
                                             `cough` == 'Y', 'Y', `cough`),
         `Changes in skin` = ifelse(`changes in skin` =='0' | `changes in skin` =='1' | `changes in skin` =='2' | `changes in skin` == '3' | `changes in skin` == '4' | `changes in skin` == 'Y', 'Y', `changes in skin`),
         `Dry mouth` = ifelse(`dry mouth` =='0' | `dry mouth` =='1' | `dry mouth` =='2' | `dry mouth` == '3' | `dry mouth` == '4' | `dry mouth` == 'Y', 'Y', `dry mouth`),
         `Nausea` = ifelse(`nausea` =='0' | `nausea` =='1' | `nausea` =='2' | `nausea` == '3' | `nausea` == '4' | `nausea` == 'Y', 'Y', ifelse(`nausea` == 'NN' | `nausea` == 'N', 'N', `nausea`)),
         `Feeling drowsy` = ifelse(`feeling drowsy` =='0' | `feeling drowsy` =='1' | `feeling drowsy` =='2' | `feeling drowsy` == '3' | `feeling drowsy` == '4' | `feeling drowsy` == 'Y', 'Y', `feeling drowsy`),
         `Numbness_tingling in hands and feet` = ifelse(`numbness_tingling in hands and feet` =='0' | `numbness_tingling in hands and feet` =='1' | `numbness_tingling in hands and feet` =='2' | `numbness_tingling in hands and feet` == '3' | `numbness_tingling in hands and feet` == '4' | `numbness_tingling in hands and feet` == 'Y', 'Y', `numbness_tingling in hands and feet`)
         ) %>%
  dplyr::select(`Difficulty concentrating`, `Pain`, `Lack of energy`, `Cough`, `Changes in skin`, `Dry mouth`, `Nausea`, `Feeling drowsy`, `Numbness_tingling in hands and feet`, gender, group) %>%
  mutate(gender = factor(gender, labels = c('Females', 'Males'))) %>%
  tbl_strata( statistic = all_continuous() ~ "{mean} ({sd})",
    strata = gender,
    .tbl_fun =
      ~ .x %>%
      # tbl_cross(`age of respondents`, group, margin = NULL) %>%
       tbl_summary(by = group, missing = "no",
            statistic = list(all_continuous() ~ "{mean} ({sd})")
            ) %>% 
      bold_labels()%>% 
      add_overall() %>%#
        add_n(),
    .header = "**{strata}**, N = {n}"
  )

table6

```


# Tables 40-69 and give results as number positive(no need for intensity like 1, 2 etc.)..also divided in total, Hiv, control, female, male - continued
```{r, message = FALSE, cache = TRUE, warning=FALSE, echo = FALSE, results='asis'}
table7 <- final_dataset %>%
  filter(visit == 1) %>%
  mutate(`Difficulty sleeping` = ifelse(`difficulty sleeping` =='1' | `difficulty sleeping` =='2' | `difficulty sleeping` == '3' | `difficulty sleeping` == '0' | `difficulty sleeping` == 'Y', 'Y', `difficulty sleeping`),
         `Feeling bloated` = ifelse(`feeling bloated` =='1' | `feeling bloated` =='2' | `feeling bloated` == '3' | `feeling bloated` == '0' | `feeling bloated` == 'Y', 'Y', `feeling bloated`),
         `Problems with urination` = ifelse(`problems with urination` =='1' | `problems with urination` =='2' | `problems with urination` == '3' | `problems with urination` == '0' | `problems with urination` == 'Y', 'Y', `problems with urination`),
         `Vomiting` = ifelse(`vomiting` =='1' | `vomiting` =='2' | `vomiting` == '3' | `vomiting` == '0' | `vomiting` == 'Y', 'Y', `vomiting`),
         `Shortness of breath` = ifelse(`shortness of breath` =='1' | `shortness of breath` =='2' | `shortness of breath` == '3' | `shortness of breath` == '0' | `shortness of breath` == 'Y', 'Y', `shortness of breath`),
         `Diarrhea` = ifelse(`diarrhea` =='1' | `diarrhea` =='2' | `diarrhea` == '3' | `diarrhea` == '0' | `diarrhea` == 'Y', 'Y', `diarrhea`),
         `Sweats` = ifelse(`sweats` =='1' | `sweats` =='2' | `sweats` == '3' | `sweats` == '0' | `sweats` == '4' | `sweats` == 'Y', 'Y', `sweats`),
         `Mouth sores` = ifelse(`mouth sores` =='1' | `mouth sores` =='2' | `mouth sores` == '3' | `mouth sores` == '0' | `mouth sores` == 'Y', 'Y', `mouth sores`),
         `Problems with sexual interest or activity` = ifelse(`problems with sexual interest or activity` =='1' | `problems with sexual interest or activity` =='2' | `problems with sexual interest or activity` == '3' | `problems with sexual interest or activity` == '0' | `problems with sexual interest or activity` == 'Y', 'Y', `problems with sexual interest or activity`),
         `Itching` = ifelse(`itching` =='1' | `itching` =='2' | `itching` == '3' | `itching` == '0' | `itching` == 'Y', 'Y', `itching`)
         ) %>%
  dplyr::select(`Difficulty sleeping`, `Feeling bloated`, `Problems with urination`, `Vomiting`, `Shortness of breath`, `Diarrhea`, `Sweats`, `Mouth sores`, `Problems with sexual interest or activity`, `Itching`, gender, group) %>%
  mutate(gender = factor(gender, labels = c('Females', 'Males'))) %>%
  tbl_strata( statistic = all_continuous() ~ "{mean} ({sd})",
    strata = gender,
    .tbl_fun =
      ~ .x %>%
      # tbl_cross(`age of respondents`, group, margin = NULL) %>%
       tbl_summary(by = group, missing = "no",
            statistic = list(all_continuous() ~ "{mean} ({sd})")
            ) %>% 
      bold_labels()%>% 
      add_overall() %>%#
        add_n(),
    .header = "**{strata}**, N = {n}"
  )

table7

```

# Tables 40-69 and give results as number positive(no need for intensity like 1, 2 etc.)..also divided in total, Hiv, control, female, male - continued
```{r, message = FALSE, cache = TRUE, warning=FALSE, echo = FALSE, results='asis'}

table8 <- final_dataset %>%
  filter(visit == 1) %>%
  mutate(`Lack of appetite` = ifelse(`lack of appetite` =='1' | `lack of appetite` =='2' | `lack of appetite` == '3' | `lack of appetite` == '0' | `lack of appetite` == '4' | `lack of appetite` == 'Y', 'Y', `lack of appetite`),
         `Dizziness` = ifelse(`dizziness` =='1' | `dizziness` =='2' | `dizziness` == '3' | `dizziness` == '0' | `dizziness` == '4' | `dizziness` == 'Y', 'Y', `dizziness`),
         `Difficulty swallowing` = ifelse(`difficulty swallowing` =='1' | `difficulty swallowing` =='2' | `difficulty swallowing` == '3' | `difficulty swallowing` == '0' | `difficulty swallowing` == '4' | `difficulty swallowing` == 'Y', 'Y', `difficulty swallowing`),
         `Change in the way food taste` = ifelse(`change in the way food taste` =='1' | `change in the way food taste` =='2' | `change in the way food taste` == '3' | `change in the way food taste` == '0' | `change in the way food taste` == 'Y', 'Y', `change in the way food taste`),
         `Weight loss` = ifelse(`weight loss` =='1' | `weight loss` =='2' | `weight loss` == '3' | `weight loss` == '0' | `weight loss` == 'Y', 'Y', `weight loss`),
         `Hair loss` = ifelse(`hair loss` =='1' | `hair loss` =='2' | `hair loss` == '3' | `hair loss` == '0' | `hair loss` == 'Y', 'Y', `hair loss`),
         `Constipation` = ifelse(`constipation` =='1' | `constipation` =='2' | `constipation` == '3' | `constipation` == '0' | `constipation` == 'Y', 'Y', `constipation`),
         `Swelling of arms or legs` = ifelse(`swelling of arms or legs` =='1' | `swelling of arms or legs` =='2' | `swelling of arms or legs` == '3' | `swelling of arms or legs` == '0' | `swelling of arms or legs` == '4' | `swelling of arms or legs` == 'Y', 'Y', `swelling of arms or legs`),
         `I don't look like myself` = ifelse(`i don't look like myself` =='0' | `i don't look like myself` =='1' | `i don't look like myself` == '2' | `i don't look like myself` == '3' | `i don't look like myself` == '4' | `i don't look like myself` == 'Y', 'Y', `i don't look like myself`),
         `Any other symptoms during the past week?` = ifelse(`any other symptoms during the past week?` =='0' | `any other symptoms during the past week?` =='1' | `any other symptoms during the past week?` == '2' | `any other symptoms during the past week?` == '3' | `any other symptoms during the past week?` == '4' | `any other symptoms during the past week?` == 'Y', 'Y', `any other symptoms during the past week?`)
         ) %>%
  dplyr::select(`Lack of appetite`, `Dizziness`, `Difficulty swallowing`, `Change in the way food taste`, `Weight loss`, `Hair loss`, `Constipation`, `Swelling of arms or legs`, `I don't look like myself`, `Any other symptoms during the past week?`, gender, group) %>%
  mutate(gender = factor(gender, labels = c('Females', 'Males'))) %>%
  tbl_strata( statistic = all_continuous() ~ "{mean} ({sd})",
    strata = gender,
    .tbl_fun =
      ~ .x %>%
      # tbl_cross(`age of respondents`, group, margin = NULL) %>%
       tbl_summary(by = group, missing = "no",
            statistic = list(all_continuous() ~ "{mean} ({sd})")
            ) %>% 
      bold_labels()%>% 
      add_overall() %>%#
        add_n(),
    .header = "**{strata}**, N = {n}"
  )

table8

```

# Table 70-73.divided in total, Hiv, control, female, male
```{r, message = FALSE, cache = TRUE, warning=FALSE, echo = FALSE, results='asis'}
table9 <- final_dataset %>%
  filter(visit == 1) %>%
  mutate(
    `Feeling sad` = `commonly_listed_symptoms_feelingsad`,
    `Worrying` = `commonly_listed_symptoms_worrying`,
    `Feeling irritable` = `commonly_listed_symptoms_feelingirritable`,
    `Feeling nervous` = `commonly_listed_symptoms_feelingnervous`
  ) %>%
  dplyr::select(`Feeling sad`, `Worrying`, `Feeling irritable`, `Feeling nervous`, gender, group) %>%
  mutate(gender = factor(gender, labels = c('Females', 'Males'))) %>%
  tbl_strata( statistic = all_continuous() ~ "{mean} ({sd})",
    strata = gender,
    .tbl_fun =
      ~ .x %>%
      # tbl_cross(`age of respondents`, group, margin = NULL) %>%
       tbl_summary(by = group, missing = "no",
            statistic = list(all_continuous() ~ "{mean} ({sd})")
            ) %>% 
      bold_labels()%>% 
      add_overall() %>%#
        add_n(),
    .header = "**{strata}**, N = {n}"
  )

table9

```

# Tables 139-142 divided in total, Hiv, control, female, male
```{r, message = FALSE, cache = TRUE, warning=FALSE, echo = FALSE, results='asis'}
table10 <- final_dataset %>%
  filter(visit == 1) %>%
  mutate(Occupation = case_when(#51#98
      occupation =='CARE WORKER' | occupation == 'CLEANER' | occupation == 'CLEANING' | occupation == 'DOMESTIC' | occupation == 'DOMESTIC WORK' | occupation == 'DOMESTIC WORKER'| occupation == 'EMPLOYED CARE WORKER' | occupation == 'GARDENER' | occupation == 'GENERAL WORKER' | occupation == 'KID CARE' | occupation == 'NANNY' | occupation == 'PIECE JOBS' ~ 'Casual worker',
occupation == 'ADMIN CLERK' | occupation == 'ANIMAL CLINIC' | occupation == 'ASSISTANCE' |
occupation == 'BOUNCER' | occupation == 'CASHIER' | occupation == 'CATERING' | occupation == 'CHEF' | occupation == 'CLERK' | occupation == 'CONSTRUCTION' | occupation == 'CONTRACT' |
occupation == 'CONTRACT BUILDER' | occupation == 'CONTROLLER' | occupation == 'COUNSELOR' |
occupation == 'DATA CAPTURER' | occupation == 'DAY CARE' | occupation == 'DRIVER' | occupation == 'EMPLOYED' | occupation == 'EMPLOYED CASHIER' | occupation == 'EMPLOYED CON' | occupation == 'EMPLOYED PETROL ATTENDER' | occupation == 'EMPLOYED SECURITY' | occupation == 'EMPOYED' |
occupation == 'LAY COUNSELLOR' | occupation == 'MACHANDISER' | occupation == 'MACHINE OPERATOR' | occupation == 'MAINTANANCE' | occupation == 'NURSE' | occupation == 'OFS FRIDGEMAKER' | occupation == 'OPERATOR' | occupation == 'PAINTER' | occupation == 'PANELBEATER' | occupation == 'PART TIME ADMIN' | occupation == 'POLICE' | occupation == 'SEAMSTRESS' | occupation == 'SECURITY' | occupation == 'SUPERVISOR' | occupation == 'TAXI DRIVER' | occupation == 'TEACHER' | occupation == 'TEMP JOB' | occupation == 'TRADE' | occupation == 'TRANSNET' | occupation == 'TRUCK DRIVER' | occupation == 'VODACOM' | occupation == 'WAITRESS' | occupation == 'WAREHOUSE' | occupation == 'WELDER' | occupation == 'WORKING' ~ 'Employed',
occupation == 'PENSIONER' ~ 'Pensoner',
occupation == 'SELF EMPLOYED' ~ 'Self employed',
occupation == 'STUDENT' |
occupation == 'STUDENT NURSING' ~ 'Student',
occupation == 'UNEMPLOYED' |
occupation == 'UNEMPLYED' ~ 'Unemployed'
    )) %>%
  mutate(
    `Marital status` = ifelse(`maritalStatus`=='DIVORCE' | maritalStatus =='DIVORCED', 'DIVORCED', maritalStatus),
    `Number of dependants` = as.character(ifelse(`number of dependants`>3, 4, `number of dependants`)),
    ) %>%
  mutate(
    `Number of dependants` = ifelse(`Number of dependants`=='4', '4 or more', `Number of dependants`)
  ) %>%
  dplyr::select(Occupation, `Marital status`, `Number of dependants`, gender, group) %>%
  mutate(gender = factor(gender, labels = c('Females', 'Males'))) %>%
  tbl_strata( statistic = all_continuous() ~ "{mean} ({sd})",
    strata = gender,
    .tbl_fun =
      ~ .x %>%
      # tbl_cross(`age of respondents`, group, margin = NULL) %>%
       tbl_summary(by = group, missing = "no",
            statistic = list(all_continuous() ~ "{mean} ({sd})")
            ) %>% 
      bold_labels() %>%
      add_overall() %>%#
        add_n(),
    .header = "**{strata}**, N = {n}"
  )

table10

```


```{r, message = FALSE, cache = TRUE, warning=FALSE, echo = FALSE, results='asis'}
table11 <- final_dataset %>%
  filter(visit == 1) %>%
  dplyr::select(pt_id, `home language`, gender, group) %>%
  separate(col = `home language`, into = c('language 1', 'language 2'), sep = ',') %>%
  pivot_longer(cols = c(`language 1`, `language 2`),
               names_to = 'col_num',
               values_to = 'language') %>%
  mutate(language = ifelse(language=='SHONA' | language=='SONAH', 'SHONA', ifelse(language=='SESOTHO' | language=='SOTHO', 'SOTHO', ifelse(language==' TSWANA', 'TSWANA', language)))) %>%
  dplyr::select(language, gender, group) %>%
  mutate(gender = factor(gender, labels = c('Females', 'Males'))) %>%
  tbl_strata( statistic = all_continuous() ~ "{mean} ({sd})",
    strata = gender,
    .tbl_fun =
      ~ .x %>%
      # tbl_cross(`age of respondents`, group, margin = NULL) %>%
       tbl_summary(by = group, missing = "no",
            statistic = list(all_continuous() ~ "{mean} ({sd})")
            ) %>% 
      bold_labels()%>% 
      add_overall() %>%#
        add_n(),
    .header = "**{strata}**, N = {n}"
  )

table11


```

# Tables 76-84
```{r, message = FALSE, cache = TRUE, warning=FALSE, echo = FALSE, results='asis'}
table12 <- final_dataset %>%
  filter(visit == 1) %>%
  mutate(`Type II Diabetes: BMI` = ifelse((`type2Diabetes_BMI`=='ERROR 2' | `type2Diabetes_BMI`=='ERROR'), '', `type2Diabetes_BMI`),
         `Type II Diabetes: waist circumfrance: Men` = `type2Diabetes_waistCircum_men`,
         `Type II Diabetes: waist circumfrance: Women` = `type2Diabetes_waistCircum_women`,
         `Type II Diabetes: Physical activities` = `type2Diabetes_physicalactivities`,
         `Type II Diabetes: Eat vegs fruits berries` = `type2Diabetes_eatvegsfruitsberries`,
         `Type II Diabetes: Meds for HBP` = `type2Diabetes_medsforHBP`,
         `Type II Diabetes: Found to have HBG` = `type2Diabetes_foundtohaveHBG`
         ) %>%
  dplyr::select(`Type II Diabetes: BMI`, `Type II Diabetes: waist circumfrance: Men`,
                `Type II Diabetes: waist circumfrance: Women`, 
                `Type II Diabetes: Physical activities`,
                `Type II Diabetes: Eat vegs fruits berries`, `Type II Diabetes: Meds for HBP`,
                `Type II Diabetes: Found to have HBG`,
                gender, group) %>%
  mutate(gender = factor(gender, labels = c('Females', 'Males'))) %>%
  tbl_strata( statistic = all_continuous() ~ "{mean} ({sd})",
    strata = gender,
    .tbl_fun =
      ~ .x %>%
      tbl_summary(by = group, missing = "no",
            statistic = list(all_continuous() ~ "{mean} ({sd})")
            ) %>% 
      bold_labels()%>% 
      add_overall() %>%#
        add_n(),
    .header = "**{strata}**, N = {n}"
  )

table12

table13 <- final_dataset %>%
  filter(visit == 1) %>%
  mutate(type2Diabetes_diabetes = ifelse(type2Diabetes_diabetes=='3P;5P', '3P,5P', type2Diabetes_diabetes)) %>%
  mutate(type2Diabetes_diabetes = ifelse(type2Diabetes_diabetes=='0p', '0P', type2Diabetes_diabetes)) %>%
  mutate(type2Diabetes_diabetes = ifelse(type2Diabetes_diabetes==' 5p' | type2Diabetes_diabetes=='5p', '5P', type2Diabetes_diabetes)) %>%
  mutate(type2Diabetes_diabetes = ifelse(type2Diabetes_diabetes=='3p', '3P', type2Diabetes_diabetes)) %>%
  filter(!is.na(`type2Diabetes_diabetes`)) %>%
  dplyr::select(pt_id, `type2Diabetes_diabetes`, gender, group) %>%
  separate(col = `type2Diabetes_diabetes`,
           sep = ',',
           into = c('col1', 'col2', 'col3'),
    remove = FALSE
    ) %>%
  dplyr::select(pt_id, col1, col2, col3, gender, group) %>%
  pivot_longer(cols = c(col1, col2, col3),
               names_to = 'col_num',
               values_to = 'type2Diabetes_diabetes') %>%
  filter(!is.na(`type2Diabetes_diabetes`)) %>%
  mutate(`Type II Diabetes: Diabetes` = type2Diabetes_diabetes) %>%
  dplyr::select(`Type II Diabetes: Diabetes`, gender, group) %>%
  mutate(gender = factor(gender, labels = c('Females', 'Males'))) %>%
  tbl_strata( statistic = all_continuous() ~ "{mean} ({sd})",
    strata = gender,
    .tbl_fun =
      ~ .x %>%
      # tbl_cross(`age of respondents`, group, margin = NULL) %>%
       tbl_summary(by = group, missing = "no",
            statistic = list(all_continuous() ~ "{mean} ({sd})")
            ) %>% 
      bold_labels()%>% 
      add_overall() %>%#
        add_n(),
    .header = "**{strata}**, N = {n}"
  )

table13

table14 <- final_dataset %>%
  filter(visit == 1) %>%
  separate(col = `type2Diabetes_familyhistorydiabetes`,
           sep = ',',
           into = c('col1', 'col2', 'col3'),
    remove = FALSE
    ) %>%
  dplyr::select(pt_id, col1, col2, col3, gender, group) %>%
  pivot_longer(cols = c(col1, col2, col3),
               names_to = 'col_num',
               values_to = 'type2Diabetes_familyhistorydiabetes') %>%
  filter(!is.na(type2Diabetes_familyhistorydiabetes)) %>%
  mutate(type2Diabetes_familyhistorydiabetes = ifelse((type2Diabetes_familyhistorydiabetes == "PARENTS" | type2Diabetes_familyhistorydiabetes == "PARENTSS"), 'PARENT', type2Diabetes_familyhistorydiabetes)) %>%
  mutate(type2Diabetes_familyhistorydiabetes = ifelse((type2Diabetes_familyhistorydiabetes == "SISTER " | type2Diabetes_familyhistorydiabetes == " SISTER"), 'SISTER', type2Diabetes_familyhistorydiabetes)) %>%
  mutate(type2Diabetes_familyhistorydiabetes = ifelse((type2Diabetes_familyhistorydiabetes == " ONCLE"), 'UNCLE', type2Diabetes_familyhistorydiabetes)) %>%
  mutate(type2Diabetes_familyhistorydiabetes = ifelse((type2Diabetes_familyhistorydiabetes == " BROTHER"), 'BROTHER', type2Diabetes_familyhistorydiabetes)) %>%
  mutate(`Type II Diabetes: Family history diabetes` = type2Diabetes_familyhistorydiabetes) %>%
  dplyr::select(`Type II Diabetes: Family history diabetes`, gender, group) %>%
  mutate(gender = factor(gender, labels = c('Females', 'Males'))) %>%
  tbl_strata( statistic = all_continuous() ~ "{mean} ({sd})",
    strata = gender,
    .tbl_fun =
      ~ .x %>%
      # tbl_cross(`age of respondents`, group, margin = NULL) %>%
       tbl_summary(by = group, missing = "no",
            statistic = list(all_continuous() ~ "{mean} ({sd})")
            ) %>% 
      bold_labels()%>% 
      add_overall() %>%#
        add_n(),
    .header = "**{strata}**, N = {n}"
  )

table14

```

# Tables 86, 88
```{r, message = FALSE, cache = TRUE, warning=FALSE, echo = FALSE, results='asis'}
table15 <- final_dataset %>%
  filter(visit == 1) %>%
  mutate(`urine Multistix: Leucocytes` = `urineMultistix_leucocytes`
         ) %>%
  dplyr::select(`has the subject fasted at least since 22:00?`, `urine Multistix: Leucocytes`,
                gender, group) %>%
  mutate(gender = factor(gender, labels = c('Females', 'Males'))) %>%
  tbl_strata( statistic = all_continuous() ~ "{mean} ({sd})",
    strata = gender,
    .tbl_fun =
      ~ .x %>%
      tbl_summary(by = group, missing = "no",
            statistic = list(all_continuous() ~ "{mean} ({sd})")
            ) %>% 
      bold_labels()%>% 
      add_overall() %>%#
        add_n(),
    .header = "**{strata}**, N = {n}"
  )

table15

```

# Tables 89-110
```{r, message = FALSE, cache = TRUE, warning=FALSE, echo = FALSE, results='asis'}
table16 <- final_dataset %>%
  filter(visit == 1) %>%
  mutate(`Urine Multistix: Nitrite` = `urineMultistix_nitrite`,
         `Urine Multistix: Urobilinogen` = `urineMultistix_urobilinogen`,
         `Urine Multistix: Protein` = `urineMultistix_protein`,
         `Urine Multistix: pH` = `urineMultistix_pH`,
         `Urine Multistix: Blood` = `urineMultistix_blood`,
         `Urine Multistix: specific gravity` = `urineMultistix_specificgravity`,
         `Urine Multistix: Ketones` = `urineMultistix_ketones`,
         `Urine Multistix: Bilirubin` = `urineMultistix_bilirubin`,
         `Urine Multistix: Glucose` = `urineMultistix_glucose`,
         `Waist circumfrance` = ifelse(`waist circumference`=='NOT DONE', NA, as.numeric(`waist circumference`)),
         `Midarm circumfrance` = ifelse(`midarm circumfrance`=='NOT DONE', NA, as.numeric(`midarm circumfrance`)),
         `Omron body composition: BMI` = ifelse(omronBodycomposition_BMI=='ERROR' | omronBodycomposition_BMI=='ERROR 4 UNDERWEIGHT' | omronBodycomposition_BMI=='UNABLE TO MEASURE' | omronBodycomposition_BMI=='ERROR 2'  | omronBodycomposition_BMI=='ERROR 4 ON OMRON' | omronBodycomposition_BMI=='ERROR 4' | omronBodycomposition_BMI=='UNDERWEIGHT', NA, as.numeric(omronBodycomposition_BMI)),
         `Omron body composition: Body fat` = ifelse(omronBodycomposition_bodyfat=='UNMEASURABLE' | omronBodycomposition_bodyfat=='UNABLE TO CALCULATE UNDERWIEGHT' | omronBodycomposition_bodyfat=='ERROR 3 ON SCALE' | omronBodycomposition_bodyfat=='ERROR 4 UNDERWEIGHT'  | omronBodycomposition_bodyfat=='UNDERWEIGHT ERROR 4' | omronBodycomposition_bodyfat=='ERROR 4' | omronBodycomposition_bodyfat=='UNDERWEIGHT', NA, as.numeric(omronBodycomposition_bodyfat)),
         `Omron body composition: Body water` = ifelse(omronBodycomposition_bodywater=='UNABLE TE GET READINGS', NA, as.numeric(omronBodycomposition_bodywater)),
         `Omron body composition: Visaerak fat` = `omronBodycomposition_visaerakfat`,
         `Omron body composition: Metabolic rate` = `omronBodycomposition_metabolicrate`,
         `Omron body composition: Muscle` = `omronBodycomposition_muscle`
         ) %>%
  dplyr::select(`Urine Multistix: Nitrite`, `Urine Multistix: Urobilinogen`, 
                `Urine Multistix: Protein`, `Urine Multistix: pH`, `Urine Multistix: Blood`,
                `Urine Multistix: specific gravity`, `Urine Multistix: Ketones`,
                `Urine Multistix: Bilirubin`, `Urine Multistix: Glucose`, 
                `heigth`, `Weight`, `Waist circumfrance`, `Midarm circumfrance`,
                `Omron body composition: BMI`, `Omron body composition: Body fat`,
                `Omron body composition: Body water`, `Omron body composition: Visaerak fat`,
                `Omron body composition: Metabolic rate`, `Omron body composition: Muscle`,
                gender, group) %>%
  mutate(gender = factor(gender, labels = c('Females', 'Males'))) %>%
  tbl_strata( statistic = all_continuous() ~ "{mean} ({sd}) ({min}) ({max})",
    strata = gender,
    .tbl_fun =
      ~ .x %>%
      tbl_summary(by = group, missing = "no",
            statistic = list(all_continuous() ~ "{mean} ({sd}) ({min}) ({max})")
            ) %>% 
      bold_labels()%>% 
      add_overall() %>%#
        add_n(),
    .header = "**{strata}**, N = {n}"
  )

table16
```

# Tables 111-135
```{r, message = FALSE, cache = TRUE, warning=FALSE, echo = FALSE, results='asis'}
table17 <- final_dataset %>%
  filter(visit == 1) %>%
  mutate(`Blood Pressures: SBP1` = `bloodpressuresmin_sbp1`,
         `Blood Pressures: DBP1` = `bloodpressuresmin_dbp1`,
         `Blood Pressures: SBP2` = bloodpressuresmin_sbp2,
         `Blood Pressures: DBP2` = bloodpressuresmin_dbp2,
         `Blood Pressures: SBP3` = bloodpressuresmin_sbp3,
         `Blood Pressures: DBP3` = bloodpressuresmin_dbp3,
         `NHLS haematology: HB` = as.numeric(ifelse(NHLS_haematology_HB=='rejected' | NHLS_haematology_HB == 'BLOED EERS 2 DAE na trek ontleed' | NHLS_haematology_HB == 'UNSUTABLE FOR TEST' | NHLS_haematology_HB == 'CLOTTED' | NHLS_haematology_HB == 'REJECTED' | NHLS_haematology_HB == 'UNSUITABLE FOR TEST' | NHLS_haematology_HB == 'UNSUITABLE' | NHLS_haematology_HB == 'NOT DETECTED', 'NA', NHLS_haematology_HB)),
         `NHLS chemical pathology creatinine` = `NHLS_chemicalpathology_creatinine`,
         `NHLS glucose Fasting` = `NHLS_glucoseFasting`,
         `NHLS glucose 30min`  = `NHLS_glucose30min`,
         `NHLS blood Chem glucose 120min` = as.numeric(ifelse(NHLS_bloodChem_glucose120min=='NO BLOOD' | NHLS_bloodChem_glucose120min=='VEINS DIFFICULT', '', NHLS_bloodChem_glucose120min)),
         `NHLS blood Chem insulin Fasting` = as.numeric(NHLS_bloodChem_insulinFasting),
         `NHLS blood Chem insulin 30min` = as.numeric(NHLS_bloodChem_insulin30min),
         `NHLS blood Chem insulin 120min` = as.numeric(ifelse(NHLS_bloodChem_insulin120min=='SPECIMEN NOT RECEIVED' | NHLS_bloodChem_insulin120min=='NO BLOOD' | NHLS_bloodChem_insulin120min=='VEINS DIFFICULT' | NHLS_bloodChem_insulin120min=='HAART0108', 'NA', NHLS_bloodChem_insulin120min)),
         `NHLS HbA1C IFCC` = as.numeric(ifelse(NHLS_HbA1C_IFCC=='CLOTTED', '', NHLS_HbA1C_IFCC)),
         `NHLS HbA1C eAG` = as.numeric(ifelse(NHLS_HbA1C_eAG=='CLOTTED', '', NHLS_HbA1C_eAG)),
         `NHLS uric acid` = as.numeric(ifelse(NHLS_uricacid=='TEST REJECTED', '', NHLS_uricacid)),
         `NHLS lipids total cholestrol` = as.numeric(ifelse(NHLS_lipids_totalcholestrol=='TEST REJECTED', '', NHLS_lipids_totalcholestrol)),
         `NHLS lipids triglyceride` = as.numeric(ifelse(NHLS_lipids_triglyceride=='TEST REJECTED' | NHLS_lipids_triglyceride=='HAART0108', '', NHLS_lipids_triglyceride)),
         `NHLS lipids HDL cholesterol` = as.numeric(ifelse(NHLS_lipids_HDLcholesterol=='TEST REJECTED' | NHLS_lipids_HDLcholesterol=='HAART0108', '', NHLS_lipids_HDLcholesterol)),
         `NHLS lipids LDL cholesterol` = as.numeric(ifelse(NHLS_lipids_LDLcholesterol=='TEST REJECTED' | NHLS_lipids_LDLcholesterol=='HAART0108', '', NHLS_lipids_LDLcholesterol)),
         `NHLS haematinics Ferritin` = as.numeric(ifelse(NHLS_haematinicsFerritin=='TEST REJECTED' | NHLS_haematinicsFerritin=='HAART0108', '', NHLS_haematinicsFerritin)),
         `NHLS serum lipidaemia Index` = ifelse(NHLS_serumlipaemiaIndex=='NOT DERECTED' | NHLS_serumlipaemiaIndex=='NOT DETECTED', 'not detected', NHLS_serumlipaemiaIndex),
         `NHLS urine creatinine` = as.numeric(ifelse(NHLS_urine_creatinine=='TEST REJECTED' | NHLS_urine_creatinine=='HAART0108', '', NHLS_urine_creatinine)),
         `NHLS urine albumin` = as.numeric(ifelse(NHLS_urine_albumin=='TEST REJECTED' | NHLS_urine_albumin=='HAART0108', '', NHLS_urine_albumin))
         
         ) %>%
  mutate(NHLS_HbA1_NGSP = ifelse(NHLS_HbA1_NGSP=='4,2', '4.2', NHLS_HbA1_NGSP)) %>%
  mutate(NHLS_HbA1_NGSP = ifelse(NHLS_HbA1_NGSP=='CLOTTED', '', NHLS_HbA1_NGSP)) %>%
  mutate(`NHLS HbA1 NGSP` = as.numeric(ifelse(NHLS_HbA1_NGSP=='unsuitable for test', '', NHLS_HbA1_NGSP))) %>%
  mutate(NHLS_serumHBindex = ifelse(NHLS_serumHBindex=='traces' | NHLS_serumHBindex=='TRACE', 'trace', NHLS_serumHBindex)) %>%
  mutate(`NHLS serum HB index` = ifelse(NHLS_serumHBindex=='NOT DETECTED', 'trace', NHLS_serumHBindex)) %>%
  mutate(NHLS_serumBilirubinindex = ifelse(NHLS_serumBilirubinindex=='traces' | NHLS_serumBilirubinindex=='TRACE', 'trace', NHLS_serumBilirubinindex)) %>%
  mutate(`NHLS serum Bilirubin index` = ifelse(NHLS_serumBilirubinindex=='NOT DETECTED', 'trace', NHLS_serumBilirubinindex)) %>%
  dplyr::select(`Blood Pressures: SBP1`, `Blood Pressures: DBP1`, `Blood Pressures: SBP2`,
                `Blood Pressures: DBP2`,`Blood Pressures: SBP3`,
                `Blood Pressures: DBP3`, 
                `NHLS haematology: HB`, `NHLS chemical pathology creatinine`, 
                `NHLS glucose Fasting`, `NHLS glucose 30min`, 
                `NHLS blood Chem glucose 120min`, `NHLS blood Chem insulin Fasting`,
                `NHLS blood Chem insulin 30min`, `NHLS blood Chem insulin 120min`,
                `NHLS HbA1 NGSP`, `NHLS HbA1C IFCC`, `NHLS HbA1C eAG`, `NHLS uric acid`,
                `NHLS lipids total cholestrol`, `NHLS lipids triglyceride`, 
                `NHLS lipids HDL cholesterol`, `NHLS lipids LDL cholesterol`,
                `NHLS haematinics Ferritin`, `NHLS serum HB index`, 
                `NHLS serum Bilirubin index`, `NHLS serum lipidaemia Index`,
                `NHLS urine creatinine`, `NHLS urine albumin`,
                gender, group) %>%
  mutate(gender = factor(gender, labels = c('Females', 'Males'))) %>%
  tbl_strata( statistic = all_continuous() ~ "{mean} ({sd}) ({min}) ({max})",
    strata = gender,
    .tbl_fun =
      ~ .x %>%
      tbl_summary(by = group, missing = "no",
            statistic = list(all_continuous() ~ "{mean} ({sd}) ({min}) ({max})")
            ) %>% 
      bold_labels()%>% 
      add_overall() %>%#
        add_n(),
    .header = "**{strata}**, N = {n}"
  )

table17

```
