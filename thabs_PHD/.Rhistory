table_1 <- final_dataset %>%
mutate(`log10 viral load` = log(`HIV viral load`, 10),
HIV_duration = as.numeric(as.Date(`Date of enrolment in study`, format='%m/%d/%Y') - as.Date(`HIV, when diagnosed`, format='%m/%d/%Y'))) %>%
dplyr::select(`Age at enrolment`, Ethnicity, `Duration of current illness`, `Opportunistic infection present`, `HIV viral load`, Sodium, Potassium, Haemoglobin, `White cell count`, `Lymphocyte count`, Neutrophils, Gender) %>%
tbl_summary(
missing = "no",
by = Gender,
# statistic = list(all_continuous() ~ "{mean} ({sd})"),
label = list(`Total CD4 count...9` ~ 'Total CD4 count')
) %>%
add_p() %>%
add_n() %>%
modify_header(label = "Variable") %>% # update the column header
bold_labels()
str(table_1)
table_1 <- final_dataset %>%
mutate(`log10 viral load` = log(`HIV viral load`, 10),
HIV_duration = as.numeric(as.Date(`Date of enrolment in study`, format='%m/%d/%Y') - as.Date(`HIV, when diagnosed`, format='%m/%d/%Y')),
gender = factor(Gender, labels = c('Females', 'Males'))) %>%
dplyr::select(`Age at enrolment`, Ethnicity, `Duration of current illness`, `Opportunistic infection present`, `HIV viral load`, Sodium, Potassium, Haemoglobin, `White cell count`, `Lymphocyte count`, Neutrophils, gender) %>%
tbl_summary(
missing = "no",
by = Gender,
# statistic = list(all_continuous() ~ "{mean} ({sd})"),
label = list(`Total CD4 count...9` ~ 'Total CD4 count')
) %>%
add_p() %>%
add_n() %>%
modify_header(label = "Variable") %>% # update the column header
bold_labels()
table_1 <- final_dataset %>%
mutate(`log10 viral load` = log(`HIV viral load`, 10),
HIV_duration = as.numeric(as.Date(`Date of enrolment in study`, format='%m/%d/%Y') - as.Date(`HIV, when diagnosed`, format='%m/%d/%Y')),
gender = factor(Gender, labels = c('Females', 'Males'))) %>%
dplyr::select(`Age at enrolment`, Ethnicity,
# `Duration of current illness`, `Opportunistic infection present`, `HIV viral load`, Sodium, Potassium, Haemoglobin, `White cell count`, `Lymphocyte count`, Neutrophils,
gender) %>%
tbl_summary(
missing = "no",
by = Gender,
# statistic = list(all_continuous() ~ "{mean} ({sd})"),
label = list(`Total CD4 count...9` ~ 'Total CD4 count')
) %>%
add_p() %>%
add_n() %>%
modify_header(label = "Variable") %>% # update the column header
bold_labels()
table_1 <- final_dataset %>%
mutate(`log10 viral load` = log(`HIV viral load`, 10),
HIV_duration = as.numeric(as.Date(`Date of enrolment in study`, format='%m/%d/%Y') - as.Date(`HIV, when diagnosed`, format='%m/%d/%Y')),
gender = factor(Gender, labels = c('Females', 'Males'))) %>%
dplyr::select(`Age at enrolment`, Ethnicity,
# `Duration of current illness`, `Opportunistic infection present`, `HIV viral load`, Sodium, Potassium, Haemoglobin, `White cell count`, `Lymphocyte count`, Neutrophils,
gender) %>%
tbl_summary(
missing = "no",
by = gender,
# statistic = list(all_continuous() ~ "{mean} ({sd})"),
label = list(`Total CD4 count...9` ~ 'Total CD4 count')
) %>%
add_p() %>%
add_n() %>%
modify_header(label = "Variable") %>% # update the column header
bold_labels()
table_1 <- final_dataset %>%
mutate(`log10 viral load` = log(`HIV viral load`, 10),
HIV_duration = as.numeric(as.Date(`Date of enrolment in study`, format='%m/%d/%Y') - as.Date(`HIV, when diagnosed`, format='%m/%d/%Y')),
gender = factor(Gender, labels = c('Females', 'Males'))) %>%
dplyr::select(`Age at enrolment`, Ethnicity, `Duration of current illness`, `Opportunistic infection present`, `HIV viral load`, `Total CD4 count...9`, Sodium, Potassium, Haemoglobin, `White cell count`, `Lymphocyte count`, Neutrophils, gender) %>%
tbl_summary(
missing = "no",
by = gender,
# statistic = list(all_continuous() ~ "{mean} ({sd})"),
label = list(`Total CD4 count...9` ~ 'Total CD4 count')
) %>%
add_p() %>%
add_n() %>%
modify_header(label = "Variable") %>% # update the column header
bold_labels()
table_1
table_1 <- final_dataset %>%
mutate(`log10 viral load` = log(`HIV viral load`, 10),
HIV_duration = as.numeric(as.Date(`Date of enrolment in study`, format='%m/%d/%Y') - as.Date(`HIV, when diagnosed`, format='%m/%d/%Y')),
gender = factor(Gender, labels = c('Females', 'Males'))) %>%
dplyr::select(`Age at enrolment`, Ethnicity, `Duration of current illness`, `Opportunistic infection present`, `log10 viral load`, `Total CD4 count...9`, Sodium, Potassium, Haemoglobin, `White cell count`, `Lymphocyte count`, Neutrophils, gender) %>%
tbl_summary(
missing = "no",
by = gender,
# statistic = list(all_continuous() ~ "{mean} ({sd})"),
label = list(`Total CD4 count...9` ~ 'Total CD4 count')
) %>%
add_p() %>%
add_n() %>%
modify_header(label = "Variable") %>% # update the column header
bold_labels()
table_1
table(final_dataset$Gender)
unlink("analysis_file_cache", recursive = TRUE)
knitr::opts_chunk$set(echo = TRUE)
knitr::opts_chunk$set(cache=TRUE)
knitr::opts_chunk$set(fig.pos = 'H')
knitr::opts_chunk$set(results = 'asis')
knitr::opts_chunk$set(echo = FALSE)
knitr::opts_chunk$set(message = FALSE)
library(tidyverse)
library(magrittr)
library(knitr)
library(kableExtra)
library(tinytex)
library(gmodels)
library(readxl)
# library(MASS)
library(gtsummary)
library(caret)
library(leaps)
library(MASS)
library(predtools)
library(randomForest)
library(mice)
library(psfmi)
library(survival)
library(ranger)
library(ggplot2)
library(dplyr)
library(ggfortify)
library(survminer)
final_dataset <- read_csv("final_dataset.csv", show_col_types = F) %>%
mutate(addisons_disease = ifelse(`Random cortisol result` < 500 & (`Synacthen: 30 minute cortisol result`< 550 & `ACTH result`> 13.9), 1, 0)) #%>%
# dat <- final_dataset %>%
# dplyr::select(`Hospital folder number`,`Random cortisol result`, `ACTH sample drawn`, `ACTH result`, `Synacthen: 0 minute cortisol result`, `Synacthen: 30 minute cortisol result`, addisons_disease)
# write.csv(dat, 'outcome_dat.csv')
final_dataset<- final_dataset%>%
mutate(Ethnicity = as.factor(Ethnicity))
contrasts(final_dataset$Ethnicity) <-
contr.treatment(levels(final_dataset$Ethnicity),                                                    base = which(levels(final_dataset$Ethnicity) == 'Black African'))
table_1 <- final_dataset %>%
mutate(`log10 viral load` = log(`HIV viral load`, 10),
HIV_duration = as.numeric(as.Date(`Date of enrolment in study`, format='%m/%d/%Y') - as.Date(`HIV, when diagnosed`, format='%m/%d/%Y')),
gender = factor(Gender, labels = c('Females', 'Males'))) %>%
dplyr::select(`Age at enrolment`, Ethnicity, `Duration of current illness`, `Opportunistic infection present`, `log10 viral load`, `Total CD4 count...9`, Sodium, Potassium, Haemoglobin, `White cell count`, `Lymphocyte count`, Neutrophils, gender) %>%
tbl_summary(
missing = "no",
by = gender,
# statistic = list(all_continuous() ~ "{mean} ({sd})"),
label = list(`Total CD4 count...9` ~ 'Total CD4 count')
) %>%
add_p() %>%
add_n() %>%
modify_header(label = "Variable") %>% # update the column header
bold_labels()
# table_1
table_1
table_1
unlink("analysis_file_cache", recursive = TRUE)
knitr::opts_chunk$set(echo = TRUE)
knitr::opts_chunk$set(cache=TRUE)
knitr::opts_chunk$set(fig.pos = 'H')
knitr::opts_chunk$set(results = 'asis')
knitr::opts_chunk$set(echo = FALSE)
knitr::opts_chunk$set(message = FALSE)
library(tidyverse)
library(magrittr)
library(knitr)
library(kableExtra)
library(tinytex)
library(gmodels)
library(readxl)
# library(MASS)
library(gtsummary)
library(caret)
library(leaps)
library(MASS)
library(predtools)
library(randomForest)
library(mice)
library(psfmi)
library(survival)
library(ranger)
library(ggplot2)
library(dplyr)
library(ggfortify)
library(survminer)
table_1 <- final_dataset %>%
mutate(`log10 viral load` = log(`HIV viral load`, 10),
HIV_duration = as.numeric(as.Date(`Date of enrolment in study`, format='%m/%d/%Y') - as.Date(`HIV, when diagnosed`, format='%m/%d/%Y')),
gender = factor(Gender, labels = c('Females', 'Males'))) %>%
dplyr::select(`Age at enrolment`, Ethnicity, `Duration of current illness`, `Opportunistic infection present`, `log10 viral load`, `Total CD4 count...9`, Sodium, Potassium, Haemoglobin, `White cell count`, `Lymphocyte count`, Neutrophils, gender) %>%
tbl_summary(
missing = "no",
by = gender,
# statistic = list(all_continuous() ~ "{mean} ({sd})"),
label = list(`Total CD4 count...9` ~ 'Total CD4 count')
) %>%
add_p() %>%
add_n() %>%
modify_header(label = "Variable") %>% # update the column header
bold_labels()
table_1
save(table_1, 'table_1.doc')
table_1 <- final_dataset %>%
mutate(`log10 viral load` = log(`HIV viral load`, 10),
HIV_duration = as.numeric(as.Date(`Date of enrolment in study`, format='%m/%d/%Y') - as.Date(`HIV, when diagnosed`, format='%m/%d/%Y')),
gender = factor(Gender, labels = c('Females', 'Males'))) %>%
dplyr::select(`Age at enrolment`, Ethnicity, `Duration of current illness`, `Opportunistic infection present`, `log10 viral load`, `Total CD4 count...9`, Sodium, Potassium, Haemoglobin, `White cell count`, `Lymphocyte count`, Neutrophils, gender) %>%
tbl_summary(
missing = "no",
by = gender,
# statistic = list(all_continuous() ~ "{mean} ({sd})"),
label = list(`Total CD4 count...9` ~ 'Total CD4 count')
) %>%
add_p() %>%
add_n() %>%
modify_header(label = "Variable") %>% # update the column header
bold_labels()
save(table_1, 'table_1.doc')
13+2.5+5+2+4+3+5+2+3+2+5+2+2+2+7+5+5
unlink("analysis_file_tables_cache", recursive = TRUE)
12.5+4+6+2+5+4+3+4+3+2+5+2+2+2+7+6+6
(((1.96)^2) * 0.5)/(((.1)^2) *0.5)
(((1.96)^2) * 0.6)/(((.1)^2) *0.4)
(((1.96)^2) * 0.6)/(((.5)^2) *0.4)
(((1.96)^2) * 0.6)/(((.05)^2) *0.4)
(((1.96)^2) * 0.75)/(((.05)^2) *0.25)
(1.96^2 * ((.5 * (1-.5)) + (.5 * (1-.5))))/0.05^2
xtab <- as.table(rbind(
c(384, 536, 335),
c(951, 869, 438)
))
dimnames(xtab) <- list(
stone = c("yes", "no"),
age = c("30-39", "40-49", "50-59")
)
xtab
#>      age
#> stone 30-39 40-49 50-59
#>   yes   384   536   335
#>   no    951   869   438
# Compare the proportion of survived between groups
prop_trend_test(xtab)
(1.96^2 * o.85^2)/(0.1^2)
(1.96^2 * 0.85^2)/(0.1^2)
(1.96^2 * 0.85^2)/(0.05^2 * 20^2)
(1.96^2 * 0.85^2)/(0.05^2 * 2^2)
(1.96^2 * 2* 75^2)/(20^2)
knitr::opts_chunk$set(echo = TRUE)
knitr::opts_chunk$set(cache=TRUE)
knitr::opts_chunk$set(fig.pos = 'H')
knitr::opts_chunk$set(results = 'asis')
knitr::opts_chunk$set(echo = FALSE)
knitr::opts_chunk$set(message = FALSE)
library(tidyverse)
library(magrittr)
library(knitr)
library(kableExtra)
library(tinytex)
library(gmodels)
library(readxl)
# library(MASS)
library(gtsummary)
library(caret)
library(leaps)
library(MASS)
library(predtools)
library(randomForest)
library(mice)
library(psfmi)
library(survival)
library(ranger)
library(ggplot2)
library(dplyr)
library(ggfortify)
library(survminer)
final_dataset <- read_csv("final_dataset.csv", show_col_types = F) %>%
mutate(addisons_disease = ifelse(`Random cortisol result` < 500 & (`Synacthen: 30 minute cortisol result`< 550 & `ACTH result`> 13.9), 1, 0)) #%>%
# dat <- final_dataset %>%
# dplyr::select(`Hospital folder number`,`Random cortisol result`, `ACTH sample drawn`, `ACTH result`, `Synacthen: 0 minute cortisol result`, `Synacthen: 30 minute cortisol result`, addisons_disease)
# write.csv(dat, 'outcome_dat.csv')
final_dataset<- final_dataset%>%
mutate(Ethnicity = as.factor(Ethnicity))
contrasts(final_dataset$Ethnicity) <-
contr.treatment(levels(final_dataset$Ethnicity),                                                    base = which(levels(final_dataset$Ethnicity) == 'Black African'))
table_mortality <- final_dataset %>%
dplyr::select(`Hospital folder number`, `3 followup_patientstatus`, `6 followup_patientstatus`, `12 followup_patientstatus`) %>%
pivot_longer(cols = c(`3 followup_patientstatus`, `6 followup_patientstatus`, `12 followup_patientstatus`),
names_to = 'col_num',
values_to = 'followup_patientstatus') %>%
dplyr::select(`Hospital folder number`, `followup_patientstatus`) %>%
group_by(`Hospital folder number`) %>%
mutate(mortality = ifelse(followup_patientstatus == 'Deceased --> EXIT form', 1,ifelse(followup_patientstatus == 'Alive', 0, 0))) %>%
dplyr::select(`Hospital folder number`, mortality)
table_mortality[is.na(table_mortality)] <- 0
table_mortality1 <- table_mortality %>%
group_by(`Hospital folder number`) %>%
mutate(mortality = max(mortality)) %>%
distinct(`Hospital folder number`, .keep_all = T)
time_to_death <- final_dataset%>%
dplyr::select(`Hospital folder number`, `3 followup_patientstatus`,
`6 followup_patientstatus`, `12 followup_patientstatus`
) %>%
mutate(flag1 = ifelse(`3 followup_patientstatus` == "Deceased --> EXIT form", 3, NA),
flag2 = ifelse(`6 followup_patientstatus` == "Deceased --> EXIT form", 6, NA),
flag3 = ifelse(`12 followup_patientstatus` == "Deceased --> EXIT form", 12, NA)) %>%
dplyr::select(`Hospital folder number`, flag1:flag3) %>%
pivot_longer(cols = c(flag1:flag3),
names_to = 'col_num',
values_to = 'time to death') %>%
dplyr::select(`Hospital folder number`, `time to death`) %>%
group_by(`Hospital folder number`) %>%
mutate(ttdeath = min(`time to death`, na.rm = T)) %>%
ungroup() %>%
mutate(ttdeath = ifelse(is.infinite(ttdeath), 12, ttdeath)) %>%
distinct(`Hospital folder number`, .keep_all = T) %>%
dplyr::select(`Hospital folder number`, ttdeath)
table_mortality1 <- table_mortality1 %>%
left_join(time_to_death, by = 'Hospital folder number')
table_4data <- final_dataset %>%
left_join(table_mortality1, by = 'Hospital folder number') %>%
mutate(addisons_disease_advanced_HIV = ifelse(addisons_disease==1 & `CD4 < 100`==1 & `Oral or inhaled steroids in the last three months`=='No', 1, 0)) %>%
mutate(HIV_duration = as.numeric(as.Date(`Date of enrolment in study`, format='%m/%d/%Y') - as.Date(`HIV, when diagnosed`, format='%m/%d/%Y')),
enrol = as.Date(`Date of enrolment in study`, format = '%m/%d/%Y'),
diagnosed = as.Date(`HIV, when diagnosed`, format = '%m/%d/%Y')) %>%
dplyr::select(`Hospital folder number`, Ethnicity, Gender, `Total CD4 count...9`, `Random cortisol result`, `Synacthen: 30 minute cortisol result`, `Synacthen: 0 minute cortisol result`, `ACTH result`, Neutrophils, `Lymphocyte count`, Haemoglobin, Sodium, Hypoglycaemia, `BP (systolic)`, `BP (diastolic)`, `Current tuberculosis`, `Duration of current illness`, HIV_duration, addisons_disease_advanced_HIV, mortality, ttdeath) %>%
left_join(dt03, by = 'Hospital folder number')
table_4data <- final_dataset %>%
left_join(table_mortality1, by = 'Hospital folder number') %>%
mutate(`log10 viral load` = log(`HIV viral load`, 10),
HIV_duration = as.numeric(as.Date(`Date of enrolment in study`, format='%m/%d/%Y') - as.Date(`HIV, when diagnosed`, format='%m/%d/%Y')),
gender = factor(Gender, labels = c('Females', 'Males')),
`Addisons disease`  = as.factor(ifelse(addisons_disease ==1, 'yes', ifelse(addisons_disease ==0, 'no', '')))) %>%
dplyr::select(`Age at enrolment`, gender, Ethnicity, `Duration of current illness`, `Opportunistic infection present`, `log10 viral load`, `Total CD4 count...9`, Sodium, Potassium, Haemoglobin, `White cell count`, `Lymphocyte count`, Neutrophils, `Addisons disease`, mortality, ttdeath)
#             by = `Addisons disease`,
#             # statistic = list(all_continuous() ~ "{mean} ({sd})"),
#             digits = list(all_categorical() ~ c(0, 2)),
#             label = list(`Total CD4 count...9` ~ 'Total CD4 count')
#             ) %>%
#   add_p() %>%
#   add_n() %>%
#   modify_header(label = "Variable") %>% # update the column header
#   bold_labels()
# table_3
tbl_uvregression(
table_4data,
method=coxph,
y = Surv(time = ttdeath, event = mortality),
exponentiate = TRUE#,
# include = -ID
)
table_3 <- final_dataset %>%
left_join(table_mortality1, by = 'Hospital folder number') %>%
mutate(`log10 viral load` = log(`HIV viral load`, 10),
HIV_duration = as.numeric(as.Date(`Date of enrolment in study`, format='%m/%d/%Y') - as.Date(`HIV, when diagnosed`, format='%m/%d/%Y')),
gender = factor(Gender, labels = c('Females', 'Males')),
`Addisons disease`  = as.factor(ifelse(addisons_disease ==1, 'yes', ifelse(addisons_disease ==0, 'no', ''))),
`Total CD4 count` = `Total CD4 count...9`) %>%
dplyr::select(`Age at enrolment`, gender, Ethnicity, `Duration of current illness`, `Opportunistic infection present`, `log10 viral load`, `Total CD4 count`, Sodium, Potassium, Haemoglobin, `White cell count`, `Lymphocyte count`, Neutrophils, `Addisons disease`, mortality, ttdeath)
#             by = `Addisons disease`,
#             # statistic = list(all_continuous() ~ "{mean} ({sd})"),
#             digits = list(all_categorical() ~ c(0, 2)),
#             label = list(`Total CD4 count...9` ~ 'Total CD4 count')
#             ) %>%
#   add_p() %>%
#   add_n() %>%
#   modify_header(label = "Variable") %>% # update the column header
#   bold_labels()
# table_3
tbl_uvregression(
table_4data,
method=coxph,
y = Surv(time = ttdeath, event = mortality),
exponentiate = TRUE#,
# include = -ID
)
table_3 <- final_dataset %>%
left_join(table_mortality1, by = 'Hospital folder number') %>%
mutate(`log10 viral load` = log(`HIV viral load`, 10),
HIV_duration = as.numeric(as.Date(`Date of enrolment in study`, format='%m/%d/%Y') - as.Date(`HIV, when diagnosed`, format='%m/%d/%Y')),
gender = factor(Gender, labels = c('Females', 'Males')),
`Addisons disease`  = as.factor(ifelse(addisons_disease ==1, 'yes', ifelse(addisons_disease ==0, 'no', ''))),
`Total CD4 count` = `Total CD4 count...9`) %>%
dplyr::select(`Age at enrolment`, gender, Ethnicity, `Duration of current illness`, `Opportunistic infection present`, `log10 viral load`, Sodium, Potassium, Haemoglobin, `White cell count`, `Lymphocyte count`, Neutrophils, `Addisons disease`, mortality, ttdeath) #, `Total CD4 count`
#             by = `Addisons disease`,
#             # statistic = list(all_continuous() ~ "{mean} ({sd})"),
#             digits = list(all_categorical() ~ c(0, 2)),
#             label = list(`Total CD4 count...9` ~ 'Total CD4 count')
#             ) %>%
#   add_p() %>%
#   add_n() %>%
#   modify_header(label = "Variable") %>% # update the column header
#   bold_labels()
# table_3
tbl_uvregression(
table_4data,
method=coxph,
y = Surv(time = ttdeath, event = mortality),
exponentiate = TRUE#,
# include = -ID
)
#             by = `Addisons disease`,
#             # statistic = list(all_continuous() ~ "{mean} ({sd})"),
#             digits = list(all_categorical() ~ c(0, 2)),
#             label = list(`Total CD4 count...9` ~ 'Total CD4 count')
#             ) %>%
#   add_p() %>%
#   add_n() %>%
#   modify_header(label = "Variable") %>% # update the column header
#   bold_labels()
# table_3
tbl_uvregression(
table_3,
method=coxph,
y = Surv(time = ttdeath, event = mortality),
exponentiate = TRUE#,
# include = -ID
)
table_2 <- final_dataset %>%
mutate(`log10 viral load` = log(`HIV viral load`, 10),
HIV_duration = as.numeric(as.Date(`Date of enrolment in study`, format='%m/%d/%Y') - as.Date(`HIV, when diagnosed`, format='%m/%d/%Y')),
gender = factor(Gender, labels = c('Females', 'Males')),
`Addisons disease`  = as.factor(ifelse(addisons_disease ==1, 'yes', ifelse(addisons_disease ==0, 'no', '')))) %>%
dplyr::select(`Age at enrolment`, gender, Ethnicity, `Duration of current illness`, `Opportunistic infection present`, `log10 viral load`, `Total CD4 count...9`, Sodium, Potassium, Haemoglobin, `White cell count`, `Lymphocyte count`, Neutrophils, `Addisons disease`) %>%
tbl_summary(#table_1,
missing = "no",
by = `Addisons disease`,
# statistic = list(all_continuous() ~ "{mean} ({sd})"),
digits = list(all_categorical() ~ c(0, 2)),
label = list(`Total CD4 count...9` ~ 'Total CD4 count')
) %>%
add_p() %>%
add_n() %>%
modify_header(label = "Variable") %>% # update the column header
bold_labels()
table_2 <- final_dataset %>%
mutate(`log10 viral load` = log(`HIV viral load`, 10),
HIV_duration = as.numeric(as.Date(`Date of enrolment in study`, format='%m/%d/%Y') - as.Date(`HIV, when diagnosed`, format='%m/%d/%Y')),
gender = factor(Gender, labels = c('Females', 'Males')),
`Addisons disease`  = as.factor(ifelse(addisons_disease ==1, 'yes', ifelse(addisons_disease ==0, 'no', '')))) %>%
dplyr::select(`Age at enrolment`, gender, Ethnicity, `Duration of current illness`, `Opportunistic infection present`, `log10 viral load`, `Total CD4 count...9`, Sodium, Potassium, Haemoglobin, `White cell count`, `Lymphocyte count`, Neutrophils, `Addisons disease`) %>%
tbl_summary(#table_1,
missing = "no",
by = `Addisons disease`,
# statistic = list(all_continuous() ~ "{mean} ({sd})"),
digits = list(all_categorical() ~ c(0, 2)),
label = list(`Total CD4 count...9` ~ 'Total CD4 count')
) %>%
add_p() %>%
add_n() %>%
modify_header(label = "Variable") %>% # update the column header
bold_labels()
table_2
str(table3)
str(data.frame(table3))
str(as.data.frame(table3))
summary(table3)
summary(table_3)
str(as.data.frame(table_3))
final_dataset <- read_csv("final_dataset.csv", show_col_types = F) %>%
mutate(addisons_disease = ifelse(`Random cortisol result` < 500 & (`Synacthen: 30 minute cortisol result`< 550 & `ACTH result`> 13.9), 1, 0)) #%>%
str(final_dataset)
table(final_dataset$Ethnicity)
summary(final_dataset$Ethnicity)
View(final_dataset)
final_dataset <- read_csv("final_dataset.csv", show_col_types = F) %>%
mutate(addisons_disease = ifelse(`Random cortisol result` < 500 & (`Synacthen: 30 minute cortisol result`< 550 & `ACTH result`> 13.9), 1, 0)) %>%
mutate(ethnicity = ifelse(Ethnicity== 'Asian' | Ethnicity== 'Coloured' | Ethnicity== 'White', 'Other', Ethnicity))
table(final_dataset$ethnicity)
table_2 <- final_dataset %>%
mutate(Ethnicity = as.character(Ethnicity)) %>%
mutate(`log10 viral load` = log(`HIV viral load`, 10),
HIV_duration = as.numeric(as.Date(`Date of enrolment in study`, format='%m/%d/%Y') - as.Date(`HIV, when diagnosed`, format='%m/%d/%Y')),
gender = factor(Gender, labels = c('Females', 'Males')),
`Addisons disease`  = as.factor(ifelse(addisons_disease ==1, 'yes', ifelse(addisons_disease ==0, 'no', ''))),
Ethnicity = ifelse(Ethnicity== 'Asian' | Ethnicity== 'Coloured' | Ethnicity== 'White', 'Other', Ethnicity)) %>%
dplyr::select(`Age at enrolment`, gender, Ethnicity, `Duration of current illness`, `Opportunistic infection present`, `log10 viral load`, `Total CD4 count...9`, Sodium, Potassium, Haemoglobin, `White cell count`, `Lymphocyte count`, Neutrophils, `Addisons disease`) %>%
tbl_summary(#table_1,
missing = "no",
by = `Addisons disease`,
# statistic = list(all_continuous() ~ "{mean} ({sd})"),
digits = list(all_categorical() ~ c(0, 1)),
label = list(`Total CD4 count...9` ~ 'Total CD4 count')
) %>%
add_p() %>%
add_n() %>%
modify_header(label = "Variable") %>% # update the column header
bold_labels()
table_2
table_3 <- final_dataset %>%
left_join(table_mortality1, by = 'Hospital folder number') %>%
mutate(Ethnicity = as.character(Ethnicity)) %>%
mutate(`log10 viral load` = log(`HIV viral load`, 10),
HIV_duration = as.numeric(as.Date(`Date of enrolment in study`, format='%m/%d/%Y') - as.Date(`HIV, when diagnosed`, format='%m/%d/%Y')),
gender = factor(Gender, labels = c('Females', 'Males')),
`Addisons disease`  = as.factor(ifelse(addisons_disease ==1, 'yes', ifelse(addisons_disease ==0, 'no', ''))),
Ethnicity = ifelse(Ethnicity== 'Asian' | Ethnicity== 'Coloured' | Ethnicity== 'White', 'Other', Ethnicity),
`Total CD4 count` = `Total CD4 count...9`) %>%
dplyr::select(`Age at enrolment`, gender, Ethnicity, `Duration of current illness`, `log10 viral load`, `Total CD4 count`, Sodium, Potassium, Haemoglobin, `White cell count`, `Lymphocyte count`, Neutrophils, `Addisons disease`, mortality, ttdeath)#`Opportunistic infection present`,
#             by = `Addisons disease`,
#             # statistic = list(all_continuous() ~ "{mean} ({sd})"),
#             digits = list(all_categorical() ~ c(0, 2)),
#             label = list(`Total CD4 count...9` ~ 'Total CD4 count')
#             ) %>%
#   add_p() %>%
#   add_n() %>%
#   modify_header(label = "Variable") %>% # update the column header
#   bold_labels()
# table_3
tbl_uvregression(
table_3,
method=coxph,
y = Surv(time = ttdeath, event = mortality),
exponentiate = TRUE#,
# include = -ID
)
