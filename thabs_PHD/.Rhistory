ggtheme = theme_bw(), # Change ggplot2 theme
palette = c("#E7B800", "#2E9FDF"),
xlim = c(0, 600)
)
survminer::ggsurvplot(km_fit,
conf.int = TRUE,
risk.table.col = "strata", # Change risk table color by groups
ggtheme = theme_bw(), # Change ggplot2 theme
palette = c("#E7B800", "#2E9FDF"),
xlim = c(0, 13)
)
km_fit <- survival::survfit(Surv(ttdeath, mortality) ~ addisons_disease_advanced_HIV,
data = model_dataset %>% mutate(`Addisons disease` = as.factor( ifelse(addisons_disease_advanced_HIV==1, 'Yes', 'No'))))
survminer::ggsurvplot(km_fit,
conf.int = TRUE,
risk.table.col = "strata", # Change risk table color by groups
ggtheme = theme_bw(), # Change ggplot2 theme
palette = c("#E7B800", "#2E9FDF"),
xlim = c(0, 13)
)
km_fit <- survival::survfit(Surv(ttdeath, mortality) ~ `Addisons disease`,
data = model_dataset %>% mutate(`Addisons disease` = as.factor( ifelse(addisons_disease_advanced_HIV==1, 'Yes', 'No'))))
km_fit <- survival::survfit(Surv(ttdeath, mortality) ~ addisons_disease_advanced_HIV,
data = model_dataset %>% mutate(`Addisons disease` = as.factor( ifelse(addisons_disease_advanced_HIV==1, 'Yes', 'No'))))
styler:::style_selection()
km_fit <- survival::survfit(Surv(ttdeath, mortality) ~ `Addisons disease`,
data = model_dataset %>% mutate(`Addisons disease` = as.factor(ifelse(addisons_disease_advanced_HIV == 1, "Yes", "No")))
)
dataset <- model_dataset %>%
mutate(`Addisons disease` = as.factor(ifelse(addisons_disease_advanced_HIV == 1, "Yes", "No")))
km_fit <- survival::survfit(Surv(ttdeath, mortality) ~ `Addisons disease`,
data = dataset
)
View(dataset)
dataset <- model_dataset %>%
mutate(Addisons_disease = as.factor(ifelse(addisons_disease_advanced_HIV == 1, "Yes", "No")))
km_fit <- survival::survfit(Surv(ttdeath, mortality) ~ Addisons_disease,
data = dataset
)
dataset <- model_dataset %>%
mutate(Addisons = as.factor(ifelse(addisons_disease_advanced_HIV == 1, "Yes", "No")))
km_fit <- survival::survfit(Surv(ttdeath, mortality) ~ Addisons,
data = dataset
)
survminer::ggsurvplot(km_fit,
conf.int = TRUE,
risk.table.col = "strata", # Change risk table color by groups
ggtheme = theme_bw(), # Change ggplot2 theme
palette = c("#E7B800", "#2E9FDF"),
xlim = c(0, 13)
)
View(model_dataset)
km_fit <- survival::survfit(Surv(ttdeath, mortality) ~ Addisons,
data = model_dataset %>%
mutate(Addisons = as.factor(ifelse(addisons_disease_advanced_HIV == 1, "Yes", "No")))
)
survminer::ggsurvplot(km_fit,
conf.int = TRUE,
risk.table.col = "strata", # Change risk table color by groups
ggtheme = theme_bw(), # Change ggplot2 theme
palette = c("#E7B800", "#2E9FDF"),
xlim = c(0, 12.5)
)
# control <- rfeControl(functions = rfFuncs, # random forest
#                       method = "cv", # repeated cvrepeated
#                       # repeats = 3, # number of repeats
#                       number = 5) # number of folds
# set.seed(33)
# results <- rfe(model_dataset[,1:17,19:20], model_dataset[[18]], sizes = c(1:5), rfeControl = control)
# var_selected <- predictors(results)
#
# finalmodel_dataset <- model_dataset %>%
#   # mutate(outcome = as.factor(utcome))%>%
#   dplyr::select(mortality, addisons_disease_advanced_HIV, var_selected)
#
# train_control <- trainControl(method = "cv", number = 5, #repeats = 100,
#                               savePredictions = T) #repeated
# set.seed(33)
# model <- train(mortality ~ .,
#   data = finalmodel_dataset,
#   trControl = train_control,
#   method = "glm",
#   family = binomial()
# )
my.variable.list <- names(model_dataset[,1:16,20:22])
My.stepwise::My.stepwise.coxph(Time = "ttdeath", Status = "mortality", variable.list = my.variable.list,
in.variable = c("addisons_disease_advanced_HIV"), data = model_dataset)
model1 <- survival::coxph(Surv(ttdeath, mortality) ~ addisons_disease_advanced_HIV + ACTH.result +
`Synacthen..30.minute.cortisol.result` + `Synacthen..0.minute.cortisol.result` + `BP..diastolic.` + `BP..systolic.` + Gender,
data = model_dataset)
summary(model1)
coef(model1)
confint(model1)
mv_table <- #data.frame(
cbind(exp(cbind(coef(model1),confint(model1))), p_value = round(summary(model1)$coefficients[,5], 4))
#)
mv_table%>%
kable(caption = "Final MV table") %>%
kable_paper("hover", full_width = F) %>%
kable_classic(full_width = F, html_font = "Arial")%>%
kable_styling(latex_options = "HOLD_position")
# # sjPlot::tab_model(model, show.icc = FALSE, show.re.var = FALSE)
# final_table <- data.frame(exp(ci(model$finalModel)[2:4,1:3])) %>%
#   mutate(Variable = c("Addison's disease advanced HIV", "Lymphocyte count", "BP diastolic")) %>%
#   dplyr::select(Variable, Estimate, CI.lower, CI.upper)
# row.names(final_table) <- 1:length(final_table$Variable)
# write.csv(final_table, 'final_table.csv')
View(model_dataset)
names(model_dataset)
58948.19 - 59491.90
59491.90-22478.75
59491.90-(59491.90*(18355.70/31294.62))
59491.90*(18355.70/31294.62)
59491.90*(18355.70/49650.32)
59491.90-(59491.90*(18355.70/49650.32))
37497.77 - 31294.62
knitr::opts_chunk$set(echo = TRUE)
knitr::opts_chunk$set(cache=TRUE)
knitr::opts_chunk$set(fig.pos = 'H')
knitr::opts_chunk$set(results = 'asis')
knitr::opts_chunk$set(echo = FALSE)
knitr::opts_chunk$set(message = FALSE)
library(tidyverse)
library(magrittr)
library(knitr)
library(kableExtra)
library(tinytex)
library(gmodels)
library(readxl)
# library(MASS)
library(gtsummary)
library(caret)
library(leaps)
library(MASS)
library(predtools)
library(randomForest)
library(mice)
library(psfmi)
library(survival)
library(ranger)
library(ggplot2)
library(dplyr)
library(ggfortify)
library(survminer)
final_dataset <- read_csv("final_dataset.csv", show_col_types = F) %>%
mutate(addisons_disease = ifelse(`Random cortisol result` < 500 & (`Synacthen: 30 minute cortisol result`< 550 & `ACTH result`> 13.9), 1, 0)) #%>%
# dat <- final_dataset %>%
# dplyr::select(`Hospital folder number`,`Random cortisol result`, `ACTH sample drawn`, `ACTH result`, `Synacthen: 0 minute cortisol result`, `Synacthen: 30 minute cortisol result`, addisons_disease)
# write.csv(dat, 'outcome_dat.csv')
socio_demographics <- final_dataset %>%
dplyr::select(`Age at enrolment`, Gender, Ethnicity)
tbl_summary(socio_demographics, missing = "no",
statistic = list(all_continuous() ~ "{mean} ({sd})")) %>%
modify_header(label = "Variable") %>% # update the column header
bold_labels()
dt01 <- final_dataset %>%
dplyr::select(`Hospital folder number`, `Primary medical conditions (1)`,
`Primary medical conditions (2)`,
`Primary medical conditions (3)`,
`Primary medical conditions (4)`,
`Primary medical conditions (5)`,
`Primary medical conditions (6)`,
`Primary medical conditions (7)`,
`Primary medical conditions (8)`,
`Primary medical conditions (9)`,
`Primary medical conditions (10)`) %>%
pivot_longer(cols = c(`Primary medical conditions (1)`,
`Primary medical conditions (2)`,
`Primary medical conditions (3)`,
`Primary medical conditions (4)`,
`Primary medical conditions (5)`,
`Primary medical conditions (6)`,
`Primary medical conditions (7)`,
`Primary medical conditions (8)`,
`Primary medical conditions (9)`,
`Primary medical conditions (10)`),
names_to = 'col_num',
values_to = 'Primary medical conditions') %>%
dplyr::select(`Hospital folder number`, `Primary medical conditions`) %>%
filter(!is.na(`Primary medical conditions`))
dt02 <- final_dataset %>%
dplyr::select(`Hospital folder number`, `Co-existing medical conditions (1)`,
`Co-existing medical conditions (2)`,
`Co-existing medical conditions (3)`,
`Co-existing medical conditions (4)`,
`Co-existing medical conditions (5)`,
`Co-existing medical conditions (6)`,
`Co-existing medical conditions (7)`,
`Co-existing medical conditions (8)`,
`Co-existing medical conditions (9)`,
`Co-existing medical conditions (10)`) %>%
pivot_longer(cols = c(`Co-existing medical conditions (1)`,
`Co-existing medical conditions (2)`,
`Co-existing medical conditions (3)`,
`Co-existing medical conditions (4)`,
`Co-existing medical conditions (5)`,
`Co-existing medical conditions (6)`,
`Co-existing medical conditions (7)`,
`Co-existing medical conditions (8)`,
`Co-existing medical conditions (9)`,
`Co-existing medical conditions (10)`),
names_to = 'col_num',
values_to = 'Co-existing medical conditions') %>%
dplyr::select(`Hospital folder number`, `Co-existing medical conditions`) %>%
filter(!is.na(`Co-existing medical conditions`))
clinical <- final_dataset %>%
mutate(`days since employment` = as.Date(`Date of enrolment in study`)- as.Date(`Last Employment date`)) %>%
dplyr::select(`HIV-positive, confirmed on ELISA`, `Total CD4 count...9`, `CD4 < 100`, `Opportunistic infection present`, `Oral or inhaled steroids in the last three months`, `days since employment`, `Duration of current illness`)
tbl_summary(clinical, missing = "no",
statistic = list(all_continuous() ~ "{mean} ({sd})")) %>%
modify_header(label = "Variable") %>% # update the column header
bold_labels()
opportunistic_infections <- final_dataset %>%
dplyr::select(`Opportunistic infection  (choice=Tuberculosis)`, `Opportunistic infection  (choice=Cryptococcus neoformans)`, `Opportunistic infection  (choice=Toxoplasmosis)`, `Opportunistic infection  (choice=Mycobacterium avium-intracellulare)`, `Opportunistic infection  (choice=Kaposis sarcoma)`, `Opportunistic infection  (choice=Cytomegalovirus)`, `Opportunistic infection  (choice=Other)`) #, `Other, specify...67`
tbl_summary(opportunistic_infections, missing = "no",
statistic = list(all_continuous() ~ "{mean} ({sd})")) %>%
modify_header(label = "Variable") %>% # update the column header
bold_labels()
signs_table1 <- final_dataset %>%
mutate(`log10 viral load` = log(`HIV viral load`, 10)) %>%
dplyr::select(`BP (systolic)`, `BP (diastolic)`, `Heart rate`, Hypotension, Weakness, Tiredness, `Poor appetite`, `Weight loss`, `Increased pigmentation of the skin`, Nausea)
tbl_summary(signs_table1, missing = "no",
statistic = list(all_continuous() ~ "{mean} ({sd})")) %>%
modify_header(label = "Variable") %>% # update the column header
bold_labels()
signs_table2 <- final_dataset %>%
mutate(`log10 viral load` = log(`HIV viral load`, 10)) %>%
dplyr::select(Vomiting, `Liking for salt`, Hypoglycaemia, `Loss of consciousness`, Diarrhoea, Dizziness, Shock, Anorexia, `Loss of axillary and pubic hair, if female`, `Any postural drop in blood pressure`)
tbl_summary(signs_table2, missing = "no",
statistic = list(all_continuous() ~ "{mean} ({sd})")) %>%
modify_header(label = "Variable") %>% # update the column header
bold_labels()
signs_table3 <- final_dataset %>%
mutate(`log10 viral load` = log(`HIV viral load`, 10)) %>%
dplyr::select(`Presence of anaemia`, `Total CD4 count...89`, `log10 viral load`, `Or, HIV viral load = LDL (choice=LDL)`, `Current tuberculosis`, `Past tuberculosis`, `Electrolytes available`, Sodium, Potassium, Urea)
tbl_summary(signs_table3, missing = "no",
statistic = list(all_continuous() ~ "{mean} ({sd})")) %>%
modify_header(label = "Variable") %>% # update the column header
bold_labels()
signs_table4 <- final_dataset %>%
mutate(`log10 viral load` = log(`HIV viral load`, 10)) %>%
dplyr::select(Creatinine, `Full blood count (FBC) result available`, Haemoglobin, `White cell count`, Platelets, MCV, `Differential on FBC available`, Neutrophils, `Lymphocyte count`, Eosinophils, Basophils, `Aetiology of anaemia`) #, `Other, specify...112`
tbl_summary(signs_table4, missing = "no",
statistic = list(all_continuous() ~ "{mean} ({sd})")) %>%
modify_header(label = "Variable") %>% # update the column header
bold_labels()
outcome_variables <- final_dataset %>%
mutate(`Random cortisol result coded` = cut(`Random cortisol result`, breaks = c(80,500,1400)),
`ACTH result coded` = cut(`ACTH result`, breaks = c(0, 13.9, 500))
) %>%
dplyr::select(`Random cortisol result`, `Random cortisol result coded`, `ACTH result`, `ACTH result coded`, `Antibodies sample drawn`, `Confirm random cortisol < 500 nmol/L`, `Confirm patient not on steroids for past 3 months`, `Synacthen: 0 minute cortisol result`, `Synacthen: 30 minute cortisol result`, addisons_disease)
tbl_summary(outcome_variables, missing = "no",
statistic = list(all_continuous() ~ "{mean} ({sd})")) %>%
modify_header(label = "Variable") %>% # update the column header
bold_labels()
ctscan <- final_dataset %>%
dplyr::select(`CT scan done`, `Bilateral adrenal enlargement`, `Calcification`, Atrophy, Haemorrhage, Nodularity, `Outcome of hospitalization`)
tbl_summary(ctscan, missing = "no",
statistic = list(all_continuous() ~ "{mean} ({sd})")) %>%
modify_header(label = "Variable") %>% # update the column header
bold_labels()
follow_up <- final_dataset %>%
dplyr::select( `3 followup_done`, `3 followup_patientstatus`, `3 followup_patientcondition`, `6 followup_done`, `6 followup_patientstatus`, `6 followup_patientcondition`, `12 followup_done`, `12 followup_patientstatus`, `12 followup_patientcondition`, `If deceased, cause of death`)
tbl_summary(follow_up, missing = "no",
statistic = list(all_continuous() ~ "{mean} ({sd})")) %>%
modify_header(label = "Variable") %>% # update the column header
bold_labels()
new_dataset <- table_4data %>%
mutate(Ethnicity = as.numeric(as.factor(Ethnicity)),
Gender = as.numeric(as.factor(Gender)),
Hypoglycaemia = as.numeric(as.factor(Hypoglycaemia)),
`Current tuberculosis` = as.numeric(as.factor(`Current tuberculosis`)),
n_primary_med_conditions = as.numeric(n_primary_med_conditions),
n_Coexisting_medical_conditions = as.numeric(n_Coexisting_medical_conditions),
`Total CD4 count` = `Total CD4 count...9`
) %>%
dplyr::select(-`Hospital folder number`, -`Total CD4 count...9`)
had_TB <- "TB"
dt01_1 <- dt01 %>%
# left_join(dt02, by = 'Hospital folder number') %>%
mutate(primary_med_condition_TB = ifelse(`Primary medical conditions`=='TB. IRIS' | `Primary medical conditions`=='TB Iris', FALSE, ifelse(`Primary medical conditions`=='MDR', TRUE,grepl(had_TB, `Primary medical conditions`, fixed = TRUE)))) %>%
group_by(`Hospital folder number`) %>%
mutate(tuberculosis = max(as.numeric(primary_med_condition_TB)),
n_primary_med_conditions = as.factor(max(1:length(`Hospital folder number`)))
) %>%
distinct(`Hospital folder number`, .keep_all = T) %>%
dplyr::select(`Hospital folder number`, tuberculosis,n_primary_med_conditions)
dt02_1 <- dt02 %>%
# left_join(dt02, by = 'Hospital folder number') %>%
mutate(Coexisting_medical_conditions_TB = #ifelse(`Co-existing medical conditions`=='TB. IRIS' | `Co-existing medical conditions` =='TB Iris', FALSE,
grepl(had_TB, `Co-existing medical conditions`, fixed = TRUE)) %>%
group_by(`Hospital folder number`) %>%
mutate(tuberculosis_2 = max(as.numeric(Coexisting_medical_conditions_TB)),
n_Coexisting_medical_conditions = as.factor(max(1:length(`Hospital folder number`)))
) %>%
distinct(`Hospital folder number`, .keep_all = T) %>%
dplyr::select(`Hospital folder number`, tuberculosis_2, n_Coexisting_medical_conditions)
dt03 <- dt01_1 %>%
full_join(dt02_1, by = 'Hospital folder number') %>%
dplyr::select(`Hospital folder number`, n_primary_med_conditions, n_Coexisting_medical_conditions,)
#GSH 169528 056 Sputum Genexpert
# coexisting medical condition: some have previous TB listed there
# GSH 45810 215, GSH 36510 881, GSH 19111 418, GSH 33987 033, GSH 115257 891
table_mortality <- final_dataset %>%
dplyr::select(`Hospital folder number`, `3 followup_patientstatus`, `6 followup_patientstatus`, `12 followup_patientstatus`) %>%
pivot_longer(cols = c(`3 followup_patientstatus`, `6 followup_patientstatus`, `12 followup_patientstatus`),
names_to = 'col_num',
values_to = 'followup_patientstatus') %>%
dplyr::select(`Hospital folder number`, `followup_patientstatus`) %>%
group_by(`Hospital folder number`) %>%
mutate(mortality = ifelse(followup_patientstatus == 'Deceased --> EXIT form', 1,ifelse(followup_patientstatus == 'Alive', 0, 0))) %>%
dplyr::select(`Hospital folder number`, mortality)
table_mortality[is.na(table_mortality)] <- 0
table_mortality1 <- table_mortality %>%
group_by(`Hospital folder number`) %>%
mutate(mortality = max(mortality)) %>%
distinct(`Hospital folder number`, .keep_all = T)
time_to_death <- final_dataset%>%
dplyr::select(`Hospital folder number`, `3 followup_patientstatus`,
`6 followup_patientstatus`, `12 followup_patientstatus`
) %>%
mutate(flag1 = ifelse(`3 followup_patientstatus` == "Deceased --> EXIT form", 3, NA),
flag2 = ifelse(`6 followup_patientstatus` == "Deceased --> EXIT form", 6, NA),
flag3 = ifelse(`12 followup_patientstatus` == "Deceased --> EXIT form", 12, NA)) %>%
dplyr::select(`Hospital folder number`, flag1:flag3) %>%
pivot_longer(cols = c(flag1:flag3),
names_to = 'col_num',
values_to = 'time to death') %>%
dplyr::select(`Hospital folder number`, `time to death`) %>%
group_by(`Hospital folder number`) %>%
mutate(ttdeath = min(`time to death`, na.rm = T)) %>%
ungroup() %>%
mutate(ttdeath = ifelse(is.infinite(ttdeath), 12, ttdeath)) %>%
distinct(`Hospital folder number`, .keep_all = T) %>%
dplyr::select(`Hospital folder number`, ttdeath)
table_mortality1 <- table_mortality1 %>%
left_join(time_to_death, by = 'Hospital folder number')
table_4data <- final_dataset %>%
left_join(table_mortality1, by = 'Hospital folder number') %>%
mutate(addisons_disease_advanced_HIV = ifelse(addisons_disease==1 & `CD4 < 100`==1 & `Oral or inhaled steroids in the last three months`=='No', 1, 0)) %>%
mutate(HIV_duration = as.numeric(as.Date(`Date of enrolment in study`, format='%m/%d/%Y') - as.Date(`HIV, when diagnosed`, format='%m/%d/%Y')),
enrol = as.Date(`Date of enrolment in study`, format = '%m/%d/%Y'),
diagnosed = as.Date(`HIV, when diagnosed`, format = '%m/%d/%Y')) %>%
dplyr::select(`Hospital folder number`, Ethnicity, Gender, `Total CD4 count...9`, `Random cortisol result`, `Synacthen: 30 minute cortisol result`, `Synacthen: 0 minute cortisol result`, `ACTH result`, Neutrophils, `Lymphocyte count`, Haemoglobin, Sodium, Hypoglycaemia, `BP (systolic)`, `BP (diastolic)`, `Current tuberculosis`, `Duration of current illness`, HIV_duration, addisons_disease_advanced_HIV, mortality, ttdeath) %>%
left_join(dt03, by = 'Hospital folder number')
new_dataset <- table_4data %>%
mutate(Ethnicity = as.numeric(as.factor(Ethnicity)),
Gender = as.numeric(as.factor(Gender)),
Hypoglycaemia = as.numeric(as.factor(Hypoglycaemia)),
`Current tuberculosis` = as.numeric(as.factor(`Current tuberculosis`)),
n_primary_med_conditions = as.numeric(n_primary_med_conditions),
n_Coexisting_medical_conditions = as.numeric(n_Coexisting_medical_conditions),
`Total CD4 count` = `Total CD4 count...9`
) %>%
dplyr::select(-`Hospital folder number`, -`Total CD4 count...9`)
nr_imputations <- 5
imputedData <- mice::mice(data = data.frame(new_dataset), m = nr_imputations, maxit = 20, meth = 'pmm', seed = 33)
completeData <- complete(imputedData, 2)
# correlationMatrix <- cor(completeData)
# highlyCorrelated <- findCorrelation(correlationMatrix)
# print(highlyCorrelated)
model_dataset <- completeData
km_fit <- survival::survfit(Surv(ttdeath, mortality) ~ Addisons,
data = model_dataset %>%
mutate(Addisons = as.factor(ifelse(addisons_disease_advanced_HIV == 1, "Yes", "No")))
)
jpeg('KM_curve.jpeg', width = 480, height = 480, units = 'px', pointsize = 14, quality = 75, bg = 'white')
survminer::ggsurvplot(km_fit,
conf.int = TRUE,
risk.table.col = "strata", # Change risk table color by groups
ggtheme = theme_bw(), # Change ggplot2 theme
palette = c("#E7B800", "#2E9FDF"),
xlim = c(0, 12.5)
)
dev.off()
my.variable.list <- names(model_dataset[,1:16,20:22])
My.stepwise::My.stepwise.coxph(Time = "ttdeath", Status = "mortality", variable.list = my.variable.list,
in.variable = c("addisons_disease_advanced_HIV"), data = model_dataset)
My.stepwise::My.stepwise.coxph(Time = "ttdeath", Status = "mortality", variable.list = my.variable.list,
in.variable = c("addisons_disease_advanced_HIV"), data = model_dataset)
model1 <- survival::coxph(Surv(ttdeath, mortality) ~ addisons_disease_advanced_HIV + ACTH.result +
`Synacthen..30.minute.cortisol.result` + `Synacthen..0.minute.cortisol.result` + `BP..diastolic.` + `BP..systolic.` + Gender,
data = model_dataset)
summary(model1)
coef(model1)
confint(model1)
mv_table <- #data.frame(
cbind(exp(cbind(coef(model1),confint(model1))), p_value = round(summary(model1)$coefficients[,5], 4))
#)
mv_table%>%
kable(caption = "Final MV table") %>%
kable_paper("hover", full_width = F) %>%
kable_classic(full_width = F, html_font = "Arial")%>%
kable_styling(latex_options = "HOLD_position")
write.csv(mv_table, 'final_table.csv')
13+2+4+2+4+3+5+2+3+2.5+6+2+3+2+6+6+6
13+2+4+2+4+3+5+2+3+2.5+6+2+3+2+6+5+5
13+2+4+2+4+3+5+2+3+2.5+6+2+3+2+6+5+5
knitr::opts_chunk$set(echo = TRUE)
knitr::opts_chunk$set(cache=TRUE)
knitr::opts_chunk$set(fig.pos = 'H')
knitr::opts_chunk$set(results = 'asis')
knitr::opts_chunk$set(echo = FALSE)
knitr::opts_chunk$set(message = FALSE)
library(tidyverse)
library(magrittr)
library(knitr)
library(kableExtra)
library(tinytex)
library(gmodels)
library(readxl)
# library(MASS)
library(gtsummary)
library(caret)
library(leaps)
library(MASS)
library(predtools)
library(randomForest)
library(mice)
library(psfmi)
library(survival)
library(ranger)
library(ggplot2)
library(dplyr)
library(ggfortify)
library(survminer)
final_dataset <- read_csv("final_dataset.csv", show_col_types = F) %>%
mutate(addisons_disease = ifelse(`Random cortisol result` < 500 & (`Synacthen: 30 minute cortisol result`< 550 & `ACTH result`> 13.9), 1, 0)) #%>%
# dat <- final_dataset %>%
# dplyr::select(`Hospital folder number`,`Random cortisol result`, `ACTH sample drawn`, `ACTH result`, `Synacthen: 0 minute cortisol result`, `Synacthen: 30 minute cortisol result`, addisons_disease)
# write.csv(dat, 'outcome_dat.csv')
table(final_dataset$Ethnicity, final_dataset$addisons_disease)
# dat <- final_dataset %>%
# dplyr::select(`Hospital folder number`,`Random cortisol result`, `ACTH sample drawn`, `ACTH result`, `Synacthen: 0 minute cortisol result`, `Synacthen: 30 minute cortisol result`, addisons_disease)
# write.csv(dat, 'outcome_dat.csv')
contrasts(final_dataset$Ethnicity) <-
contr.treatment(levels(final_dataset$Ethnicity,                                                    base = which(levels(as.factor(final_dataset$Ethnicity) == 'Black African'))))
# dat <- final_dataset %>%
# dplyr::select(`Hospital folder number`,`Random cortisol result`, `ACTH sample drawn`, `ACTH result`, `Synacthen: 0 minute cortisol result`, `Synacthen: 30 minute cortisol result`, addisons_disease)
# write.csv(dat, 'outcome_dat.csv')
contrasts(final_dataset$Ethnicity) <-
contr.treatment(levels(final_dataset$Ethnicity,                                                    base = which(levels((final_dataset$Ethnicity) == 'Black African'))))
# dat <- final_dataset %>%
# dplyr::select(`Hospital folder number`,`Random cortisol result`, `ACTH sample drawn`, `ACTH result`, `Synacthen: 0 minute cortisol result`, `Synacthen: 30 minute cortisol result`, addisons_disease)
# write.csv(dat, 'outcome_dat.csv')
final_dataset<- final_dataset%>%
mutate(Ethnicity = as.factor(Ethnicity))
contrasts(final_dataset$Ethnicity) <-
contr.treatment(levels(final_dataset$Ethnicity,                                                    base = which(levels((final_dataset$Ethnicity) == 'Black African'))))
which(levels(final_dataset$Ethnicity) == 'Black African')
contrasts(final_dataset$Ethnicity) <- contr.treatment(levels(final_dataset$Ethnicity,                                                    base = which(levels(final_dataset$Ethnicity) == 'Black African')))
contrasts(final_dataset$Ethnicity) <- contr.treatment(levels(final_dataset$Ethnicity,                                                    base = '2'))
trial2 <-
trial %>%
mutate(
agecat = case_when(
between(age, 0, 20) ~ "0-20",
between(age, 21, 40) ~ "21-40",
between(age, 41, 60) ~ "41-60",
between(age, 61, 83) ~ "61-83"
) %>%
factor(),
)
View(trial2)
str(trial2)
contrasts(trial2$agecat) <-
contr.treatment(levels(trial2$agecat),
base = which(levels(trial2$agecat) == "61-83")
)
contrasts(final_dataset$Ethnicity) <-
contr.treatment(levels(final_dataset$Ethnicity),                                                    base = which(levels(final_dataset$Ethnicity) == 'Black African'))
socio_demographics2 <- final_dataset %>%
mutate(addisons_disease_advanced_HIV = ifelse(addisons_disease==1 & `CD4 < 100`==1 & `Oral or inhaled steroids in the last three months`=='No', 1, 0)) %>%
mutate(gender = as.factor(Gender),
ethnicity = as.factor(Ethnicity)) %>%
dplyr::select(addisons_disease_advanced_HIV, `Age at enrolment`, gender, ethnicity)
tbl_uvregression(
socio_demographics2[c('addisons_disease_advanced_HIV', 'Age at enrolment', 'gender', 'ethnicity')],
method = glm,
y = addisons_disease_advanced_HIV,
method.args = list(family = binomial),
exponentiate = TRUE
)
tbl_uvregression(
socio_demographics2[c('addisons_disease_advanced_HIV', 'Age at enrolment', 'gender', 'ethnicity')],
method = glm,
y = addisons_disease_advanced_HIV,
method.args = list(family = binomial),
exponentiate = TRUE
) %>%
add_nevent(location = "level")
tbl_uvregression(
socio_demographics2[c('addisons_disease_advanced_HIV', 'Age at enrolment', 'gender', 'ethnicity')],
method = glm,
y = addisons_disease_advanced_HIV,
method.args = list(family = binomial),
exponentiate = TRUE
) %>%
add_difference()
View(socio_demographics2)
socio_demographics2 %>%
dplyr::select(addisons_disease_advanced_HIV, `Age at enrolment`, gender, ethnicity) %>%
tbl_summary(by = addisons_disease_advanced_HIV,
missing = "no",
statistic = marker ~ "{mean} ({sd})") %>%
add_difference()
socio_demographics2 %>%
dplyr::select(addisons_disease_advanced_HIV, `Age at enrolment`, gender, ethnicity) %>%
tbl_summary(by = addisons_disease_advanced_HIV,
missing = "no",
statistic = `Age at enrolment` ~ "{mean} ({sd})") %>%
add_difference()
