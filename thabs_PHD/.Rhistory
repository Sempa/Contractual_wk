pivot_longer(cols = c(flag1:flag3),
names_to = 'col_num',
values_to = 'time to death') %>%
dplyr::select(`Hospital folder number`, `time to death`) %>%
group_by(`Hospital folder number`) %>%
mutate(ttdeath = min(`time to death`, na.rm = T)) %>%
ungroup() %>%
mutate(ttdeath = ifelse(is.infinite(ttdeath), NA, ttdeath))
dt01 <- final_dataset %>%
dplyr::select(`Hospital folder number`, `Primary medical conditions (1)`,
`Primary medical conditions (2)`,
`Primary medical conditions (3)`,
`Primary medical conditions (4)`,
`Primary medical conditions (5)`,
`Primary medical conditions (6)`,
`Primary medical conditions (7)`,
`Primary medical conditions (8)`,
`Primary medical conditions (9)`,
`Primary medical conditions (10)`) %>%
pivot_longer(cols = c(`Primary medical conditions (1)`,
`Primary medical conditions (2)`,
`Primary medical conditions (3)`,
`Primary medical conditions (4)`,
`Primary medical conditions (5)`,
`Primary medical conditions (6)`,
`Primary medical conditions (7)`,
`Primary medical conditions (8)`,
`Primary medical conditions (9)`,
`Primary medical conditions (10)`),
names_to = 'col_num',
values_to = 'Primary medical conditions') %>%
dplyr::select(`Hospital folder number`, `Primary medical conditions`) %>%
filter(!is.na(`Primary medical conditions`))
dt02 <- final_dataset %>%
dplyr::select(`Hospital folder number`, `Co-existing medical conditions (1)`,
`Co-existing medical conditions (2)`,
`Co-existing medical conditions (3)`,
`Co-existing medical conditions (4)`,
`Co-existing medical conditions (5)`,
`Co-existing medical conditions (6)`,
`Co-existing medical conditions (7)`,
`Co-existing medical conditions (8)`,
`Co-existing medical conditions (9)`,
`Co-existing medical conditions (10)`) %>%
pivot_longer(cols = c(`Co-existing medical conditions (1)`,
`Co-existing medical conditions (2)`,
`Co-existing medical conditions (3)`,
`Co-existing medical conditions (4)`,
`Co-existing medical conditions (5)`,
`Co-existing medical conditions (6)`,
`Co-existing medical conditions (7)`,
`Co-existing medical conditions (8)`,
`Co-existing medical conditions (9)`,
`Co-existing medical conditions (10)`),
names_to = 'col_num',
values_to = 'Co-existing medical conditions') %>%
dplyr::select(`Hospital folder number`, `Co-existing medical conditions`) %>%
filter(!is.na(`Co-existing medical conditions`))
had_TB <- "TB"
dt01_1 <- dt01 %>%
# left_join(dt02, by = 'Hospital folder number') %>%
mutate(primary_med_condition_TB = ifelse(`Primary medical conditions`=='TB. IRIS' | `Primary medical conditions`=='TB Iris', FALSE, ifelse(`Primary medical conditions`=='MDR', TRUE,grepl(had_TB, `Primary medical conditions`, fixed = TRUE)))) %>%
group_by(`Hospital folder number`) %>%
mutate(tuberculosis = max(as.numeric(primary_med_condition_TB)),
n_primary_med_conditions = as.factor(max(1:length(`Hospital folder number`)))
) %>%
distinct(`Hospital folder number`, .keep_all = T) %>%
dplyr::select(`Hospital folder number`, tuberculosis,n_primary_med_conditions)
dt02_1 <- dt02 %>%
# left_join(dt02, by = 'Hospital folder number') %>%
mutate(Coexisting_medical_conditions_TB = #ifelse(`Co-existing medical conditions`=='TB. IRIS' | `Co-existing medical conditions` =='TB Iris', FALSE,
grepl(had_TB, `Co-existing medical conditions`, fixed = TRUE)) %>%
group_by(`Hospital folder number`) %>%
mutate(tuberculosis_2 = max(as.numeric(Coexisting_medical_conditions_TB)),
n_Coexisting_medical_conditions = as.factor(max(1:length(`Hospital folder number`)))
) %>%
distinct(`Hospital folder number`, .keep_all = T) %>%
dplyr::select(`Hospital folder number`, tuberculosis_2, n_Coexisting_medical_conditions)
dt03 <- dt01_1 %>%
full_join(dt02_1, by = 'Hospital folder number') %>%
dplyr::select(`Hospital folder number`, n_primary_med_conditions, n_Coexisting_medical_conditions,)
table_mortality <- final_dataset %>%
dplyr::select(`Hospital folder number`, `3 followup_patientstatus`, `6 followup_patientstatus`, `12 followup_patientstatus`) %>%
pivot_longer(cols = c(`3 followup_patientstatus`, `6 followup_patientstatus`, `12 followup_patientstatus`),
names_to = 'col_num',
values_to = 'followup_patientstatus') %>%
dplyr::select(`Hospital folder number`, `followup_patientstatus`) %>%
group_by(`Hospital folder number`) %>%
mutate(mortality = ifelse(followup_patientstatus == 'Deceased --> EXIT form', 1,ifelse(followup_patientstatus == 'Alive', 0, 0))) %>%
dplyr::select(`Hospital folder number`, mortality)
table_mortality[is.na(table_mortality)] <- 0
table_mortality1 <- table_mortality %>%
group_by(`Hospital folder number`) %>%
mutate(mortality = max(mortality)) %>%
distinct(`Hospital folder number`, .keep_all = T)
time_to_death <- final_dataset%>%
dplyr::select(`Hospital folder number`, `3 followup_patientstatus`,
`6 followup_patientstatus`, `12 followup_patientstatus`
) %>%
mutate(flag1 = ifelse(`3 followup_patientstatus` == "Deceased --> EXIT form", 3, NA),
flag2 = ifelse(`6 followup_patientstatus` == "Deceased --> EXIT form", 6, NA),
flag3 = ifelse(`12 followup_patientstatus` == "Deceased --> EXIT form", 12, NA)) %>%
dplyr::select(`Hospital folder number`, flag1:flag3) %>%
pivot_longer(cols = c(flag1:flag3),
names_to = 'col_num',
values_to = 'time to death') %>%
dplyr::select(`Hospital folder number`, `time to death`) %>%
group_by(`Hospital folder number`) %>%
mutate(ttdeath = min(`time to death`, na.rm = T)) %>%
ungroup() %>%
mutate(ttdeath = ifelse(is.infinite(ttdeath), NA, ttdeath))
time_to_death <- final_dataset%>%
dplyr::select(`Hospital folder number`, `3 followup_patientstatus`,
`6 followup_patientstatus`, `12 followup_patientstatus`
) %>%
mutate(flag1 = ifelse(`3 followup_patientstatus` == "Deceased --> EXIT form", 3, NA),
flag2 = ifelse(`6 followup_patientstatus` == "Deceased --> EXIT form", 6, NA),
flag3 = ifelse(`12 followup_patientstatus` == "Deceased --> EXIT form", 12, NA)) %>%
dplyr::select(`Hospital folder number`, flag1:flag3) %>%
pivot_longer(cols = c(flag1:flag3),
names_to = 'col_num',
values_to = 'time to death') %>%
dplyr::select(`Hospital folder number`, `time to death`) %>%
group_by(`Hospital folder number`) %>%
mutate(ttdeath = min(`time to death`, na.rm = T)) %>%
ungroup() %>%
mutate(ttdeath = ifelse(is.infinite(ttdeath), NA, ttdeath)) %>%
distinct(`Hospital folder number`, .keep_all = T) %>%
dplyr::select(`Hospital folder number`, ttdeath)
table_mortality1 <- table_mortality1 %>%
left_join(time_to_death, by = 'Hospital folder number')
View(table_mortality1)
table_4data <- final_dataset %>%
left_join(table_mortality1, by = 'Hospital folder number') %>%
mutate(addisons_disease_advanced_HIV = ifelse(addisons_disease==1 & `CD4 < 100`==1 & `Oral or inhaled steroids in the last three months`=='No', 1, 0)) %>%
mutate(HIV_duration = as.numeric(as.Date(`Date of enrolment in study`, format='%m/%d/%Y') - as.Date(`HIV, when diagnosed`, format='%m/%d/%Y')),
enrol = as.Date(`Date of enrolment in study`, format = '%m/%d/%Y'),
diagnosed = as.Date(`HIV, when diagnosed`, format = '%m/%d/%Y')) %>%
dplyr::select(`Hospital folder number`, Ethnicity, Gender, `Total CD4 count...9`, `Random cortisol result`, `Synacthen: 30 minute cortisol result`, `Synacthen: 0 minute cortisol result`, `ACTH result`, Neutrophils, `Lymphocyte count`, Haemoglobin, Sodium, Hypoglycaemia, `BP (systolic)`, `BP (diastolic)`, `Current tuberculosis`, `Duration of current illness`, HIV_duration, addisons_disease_advanced_HIV, mortality) %>%
left_join(dt03, by = 'Hospital folder number')
View(table_4data)
table_4data <- final_dataset %>%
left_join(table_mortality1, by = 'Hospital folder number') %>%
mutate(addisons_disease_advanced_HIV = ifelse(addisons_disease==1 & `CD4 < 100`==1 & `Oral or inhaled steroids in the last three months`=='No', 1, 0)) %>%
mutate(HIV_duration = as.numeric(as.Date(`Date of enrolment in study`, format='%m/%d/%Y') - as.Date(`HIV, when diagnosed`, format='%m/%d/%Y')),
enrol = as.Date(`Date of enrolment in study`, format = '%m/%d/%Y'),
diagnosed = as.Date(`HIV, when diagnosed`, format = '%m/%d/%Y')) %>%
dplyr::select(`Hospital folder number`, Ethnicity, Gender, `Total CD4 count...9`, `Random cortisol result`, `Synacthen: 30 minute cortisol result`, `Synacthen: 0 minute cortisol result`, `ACTH result`, Neutrophils, `Lymphocyte count`, Haemoglobin, Sodium, Hypoglycaemia, `BP (systolic)`, `BP (diastolic)`, `Current tuberculosis`, `Duration of current illness`, HIV_duration, addisons_disease_advanced_HIV, mortality, ttdeath) %>%
left_join(dt03, by = 'Hospital folder number')
table_4Adata_1_1 <- table_4data %>%
dplyr::select(Ethnicity, Gender, `Total CD4 count...9`, `Random cortisol result`, `Synacthen: 30 minute cortisol result`, `Synacthen: 0 minute cortisol result`, `ACTH result`, Neutrophils, `Lymphocyte count`, Haemoglobin, mortality, ttdeath) %>%
tbl_uvregression(
trial[c("ttdeath", "mortality", 'Ethnicity', 'Gender', 'Total CD4 count...9', 'Random cortisol result', 'Synacthen: 30 minute cortisol result', 'Synacthen: 0 minute cortisol result', 'ACTH result', 'Neutrophils', 'Lymphocyte count', 'Haemoglobin')],
method = coxph,
y = Surv(ttdeath, mortality),
exponentiate = TRUE,
pvalue_fun = function(x) style_pvalue(x, digits = 2)
) %>%
modify_header(label = "Variable") %>% # update the column header
bold_labels()
table_4Adata_1_1 <- table_4data %>%
dplyr::select(Ethnicity, Gender, `Total CD4 count...9`, `Random cortisol result`, `Synacthen: 30 minute cortisol result`, `Synacthen: 0 minute cortisol result`, `ACTH result`, Neutrophils, `Lymphocyte count`, Haemoglobin, mortality, ttdeath) #%>%
tbl_uvregression(
table_4Adata_1_1[c("ttdeath", "mortality", 'Ethnicity', 'Gender', 'Total CD4 count...9', 'Random cortisol result', 'Synacthen: 30 minute cortisol result', 'Synacthen: 0 minute cortisol result', 'ACTH result', 'Neutrophils', 'Lymphocyte count', 'Haemoglobin')],
method = coxph,
y = Surv(ttdeath, mortality),
exponentiate = TRUE,
pvalue_fun = function(x) style_pvalue(x, digits = 2)
) %>%
modify_header(label = "Variable") %>% # update the column header
bold_labels()
table_4Adata_1_1 <- table_4data %>%
mutate(`Total CD4 count` = `Total CD4 count...9`) %>%
dplyr::select(Ethnicity, Gender, `Total CD4 count`, `Random cortisol result`, `Synacthen: 30 minute cortisol result`, `Synacthen: 0 minute cortisol result`, `ACTH result`, Neutrophils, `Lymphocyte count`, Haemoglobin, mortality, ttdeath) #%>%
tbl_uvregression(
table_4Adata_1_1[c("ttdeath", "mortality", 'Ethnicity', 'Gender', 'Total CD4 count', 'Random cortisol result', 'Synacthen: 30 minute cortisol result', 'Synacthen: 0 minute cortisol result', 'ACTH result', 'Neutrophils', 'Lymphocyte count', 'Haemoglobin')],
method = coxph,
y = Surv(ttdeath, mortality),
exponentiate = TRUE,
pvalue_fun = function(x) style_pvalue(x, digits = 2)
) %>%
modify_header(label = "Variable") %>% # update the column header
bold_labels()
table_4Adata_1_1
tbl_uvregression(
table_4Adata_1_1[c("ttdeath", "mortality", 'Ethnicity', 'Gender', 'Total CD4 count', 'Random cortisol result', 'Synacthen: 30 minute cortisol result', 'Synacthen: 0 minute cortisol result', 'ACTH result', 'Neutrophils', 'Lymphocyte count', 'Haemoglobin')],
method = coxph,
y = Surv(ttdeath, mortality),
exponentiate = TRUE,
pvalue_fun = function(x) style_pvalue(x, digits = 2)
) %>%
modify_header(label = "Variable") %>% # update the column header
bold_labels()
table_4Adata_2_1 <- table_4data %>%
mutate(`HIV duration` = HIV_duration,
`Number of primary med conditions` = n_primary_med_conditions,
`Number Coexisting medical conditions`  = n_Coexisting_medical_conditions,
`Addisons disease advanced HIV` = addisons_disease_advanced_HIV) %>%
dplyr::select(Sodium, Hypoglycaemia, `BP (systolic)`, `BP (diastolic)`, `Current tuberculosis`, `Duration of current illness`, `HIV duration`, `Number of primary med conditions`, `Number Coexisting medical conditions`, `Addisons disease advanced HIV`, mortality, ttdeath)
tbl_uvregression(
table_4Adata_2_1[c("ttdeath", "mortality", 'Sodium', 'Hypoglycaemia', 'BP (systolic)', 'BP (diastolic)', 'Current tuberculosis', 'Duration of current illness', 'HIV duration', 'Number of primary med conditions', 'Number Coexisting medical conditions', 'Addisons disease advanced HIV')],
method = coxph,
y = Surv(ttdeath, mortality),
exponentiate = TRUE,
pvalue_fun = function(x) style_pvalue(x, digits = 2)
) %>%
modify_header(label = "Variable") %>% # update the column header
bold_labels()
>>>>>>> 472925bdbfb9f0a55636e3f3834d75e82324909f
>>>>>>> ec6e42950bf99640b14a7e343f407b63aebe7d57
knitr::opts_chunk$set(echo = TRUE)
knitr::opts_chunk$set(cache=TRUE)
knitr::opts_chunk$set(fig.pos = 'H')
knitr::opts_chunk$set(results = 'asis')
knitr::opts_chunk$set(echo = FALSE)
knitr::opts_chunk$set(message = FALSE)
library(tidyverse)
library(magrittr)
library(knitr)
library(kableExtra)
library(tinytex)
library(gmodels)
library(readxl)
# library(MASS)
library(gtsummary)
library(caret)
library(leaps)
library(MASS)
library(predtools)
library(randomForest)
library(mice)
library(psfmi)
library(survival)
library(ranger)
library(ggplot2)
library(dplyr)
library(ggfortify)
library(survminer)
final_dataset <- read_csv("final_dataset.csv", show_col_types = F) %>%
mutate(addisons_disease = ifelse(`Random cortisol result` < 500 & (`Synacthen: 30 minute cortisol result`< 550 & `ACTH result`> 13.9), 1, 0)) #%>%
# dat <- final_dataset %>%
# dplyr::select(`Hospital folder number`,`Random cortisol result`, `ACTH sample drawn`, `ACTH result`, `Synacthen: 0 minute cortisol result`, `Synacthen: 30 minute cortisol result`, addisons_disease)
# write.csv(dat, 'outcome_dat.csv')
final_dataset<- final_dataset%>%
mutate(Ethnicity = as.factor(Ethnicity))
contrasts(final_dataset$Ethnicity) <-
contr.treatment(levels(final_dataset$Ethnicity),                                                    base = which(levels(final_dataset$Ethnicity) == 'Black African'))
str(final_dataset$`HIV viral load`)
str(final_dataset$`CD4 < 100`)
str(final_dataset$`CD4 count date`)
table_1 <- final_dataset %>%
mutate(`log10 viral load` = log(`HIV viral load`, 10),
HIV_duration = as.numeric(as.Date(`Date of enrolment in study`, format='%m/%d/%Y') - as.Date(`HIV, when diagnosed`, format='%m/%d/%Y'))) %>%
dplyr::select(Gender, `Age at enrolment`, Ethnicity, `Duration of current illness`, `Opportunistic infection present`, `HIV viral load`, Sodium, Potassium, Haemoglobin, `White cell count`, `Lymphocyte count`, Neutrophils) %>%
tbl_summary(
missing = "no",
by = Gender,
# statistic = list(all_continuous() ~ "{mean} ({sd})"),
label = list(`Total CD4 count...9` ~ 'Total CD4 count')
) %>%
add_p() %>%
add_n() %>%
modify_header(label = "Variable") %>% # update the column header
bold_labels()
table_1 <- final_dataset %>%
mutate(`log10 viral load` = log(`HIV viral load`, 10),
HIV_duration = as.numeric(as.Date(`Date of enrolment in study`, format='%m/%d/%Y') - as.Date(`HIV, when diagnosed`, format='%m/%d/%Y'))) %>%
dplyr::select(`Age at enrolment`, Ethnicity, `Duration of current illness`, `Opportunistic infection present`, `HIV viral load`, Sodium, Potassium, Haemoglobin, `White cell count`, `Lymphocyte count`, Neutrophils, Gender)
table_1 <- final_dataset %>%
mutate(`log10 viral load` = log(`HIV viral load`, 10),
HIV_duration = as.numeric(as.Date(`Date of enrolment in study`, format='%m/%d/%Y') - as.Date(`HIV, when diagnosed`, format='%m/%d/%Y'))) %>%
dplyr::select(`Age at enrolment`, Ethnicity, `Duration of current illness`, `Opportunistic infection present`, `HIV viral load`, Sodium, Potassium, Haemoglobin, `White cell count`, `Lymphocyte count`, Neutrophils, Gender) %>%
tbl_summary(
missing = "no",
by = Gender,
# statistic = list(all_continuous() ~ "{mean} ({sd})"),
label = list(`Total CD4 count...9` ~ 'Total CD4 count')
) %>%
add_p() %>%
add_n() %>%
modify_header(label = "Variable") %>% # update the column header
bold_labels()
str(table_1)
table_1 <- final_dataset %>%
mutate(`log10 viral load` = log(`HIV viral load`, 10),
HIV_duration = as.numeric(as.Date(`Date of enrolment in study`, format='%m/%d/%Y') - as.Date(`HIV, when diagnosed`, format='%m/%d/%Y')),
gender = factor(Gender, labels = c('Females', 'Males'))) %>%
dplyr::select(`Age at enrolment`, Ethnicity, `Duration of current illness`, `Opportunistic infection present`, `HIV viral load`, Sodium, Potassium, Haemoglobin, `White cell count`, `Lymphocyte count`, Neutrophils, gender) %>%
tbl_summary(
missing = "no",
by = Gender,
# statistic = list(all_continuous() ~ "{mean} ({sd})"),
label = list(`Total CD4 count...9` ~ 'Total CD4 count')
) %>%
add_p() %>%
add_n() %>%
modify_header(label = "Variable") %>% # update the column header
bold_labels()
table_1 <- final_dataset %>%
mutate(`log10 viral load` = log(`HIV viral load`, 10),
HIV_duration = as.numeric(as.Date(`Date of enrolment in study`, format='%m/%d/%Y') - as.Date(`HIV, when diagnosed`, format='%m/%d/%Y')),
gender = factor(Gender, labels = c('Females', 'Males'))) %>%
dplyr::select(`Age at enrolment`, Ethnicity,
# `Duration of current illness`, `Opportunistic infection present`, `HIV viral load`, Sodium, Potassium, Haemoglobin, `White cell count`, `Lymphocyte count`, Neutrophils,
gender) %>%
tbl_summary(
missing = "no",
by = Gender,
# statistic = list(all_continuous() ~ "{mean} ({sd})"),
label = list(`Total CD4 count...9` ~ 'Total CD4 count')
) %>%
add_p() %>%
add_n() %>%
modify_header(label = "Variable") %>% # update the column header
bold_labels()
table_1 <- final_dataset %>%
mutate(`log10 viral load` = log(`HIV viral load`, 10),
HIV_duration = as.numeric(as.Date(`Date of enrolment in study`, format='%m/%d/%Y') - as.Date(`HIV, when diagnosed`, format='%m/%d/%Y')),
gender = factor(Gender, labels = c('Females', 'Males'))) %>%
dplyr::select(`Age at enrolment`, Ethnicity,
# `Duration of current illness`, `Opportunistic infection present`, `HIV viral load`, Sodium, Potassium, Haemoglobin, `White cell count`, `Lymphocyte count`, Neutrophils,
gender) %>%
tbl_summary(
missing = "no",
by = gender,
# statistic = list(all_continuous() ~ "{mean} ({sd})"),
label = list(`Total CD4 count...9` ~ 'Total CD4 count')
) %>%
add_p() %>%
add_n() %>%
modify_header(label = "Variable") %>% # update the column header
bold_labels()
table_1 <- final_dataset %>%
mutate(`log10 viral load` = log(`HIV viral load`, 10),
HIV_duration = as.numeric(as.Date(`Date of enrolment in study`, format='%m/%d/%Y') - as.Date(`HIV, when diagnosed`, format='%m/%d/%Y')),
gender = factor(Gender, labels = c('Females', 'Males'))) %>%
dplyr::select(`Age at enrolment`, Ethnicity, `Duration of current illness`, `Opportunistic infection present`, `HIV viral load`, `Total CD4 count...9`, Sodium, Potassium, Haemoglobin, `White cell count`, `Lymphocyte count`, Neutrophils, gender) %>%
tbl_summary(
missing = "no",
by = gender,
# statistic = list(all_continuous() ~ "{mean} ({sd})"),
label = list(`Total CD4 count...9` ~ 'Total CD4 count')
) %>%
add_p() %>%
add_n() %>%
modify_header(label = "Variable") %>% # update the column header
bold_labels()
table_1
table_1 <- final_dataset %>%
mutate(`log10 viral load` = log(`HIV viral load`, 10),
HIV_duration = as.numeric(as.Date(`Date of enrolment in study`, format='%m/%d/%Y') - as.Date(`HIV, when diagnosed`, format='%m/%d/%Y')),
gender = factor(Gender, labels = c('Females', 'Males'))) %>%
dplyr::select(`Age at enrolment`, Ethnicity, `Duration of current illness`, `Opportunistic infection present`, `log10 viral load`, `Total CD4 count...9`, Sodium, Potassium, Haemoglobin, `White cell count`, `Lymphocyte count`, Neutrophils, gender) %>%
tbl_summary(
missing = "no",
by = gender,
# statistic = list(all_continuous() ~ "{mean} ({sd})"),
label = list(`Total CD4 count...9` ~ 'Total CD4 count')
) %>%
add_p() %>%
add_n() %>%
modify_header(label = "Variable") %>% # update the column header
bold_labels()
table_1
table(final_dataset$Gender)
unlink("analysis_file_cache", recursive = TRUE)
knitr::opts_chunk$set(echo = TRUE)
knitr::opts_chunk$set(cache=TRUE)
knitr::opts_chunk$set(fig.pos = 'H')
knitr::opts_chunk$set(results = 'asis')
knitr::opts_chunk$set(echo = FALSE)
knitr::opts_chunk$set(message = FALSE)
library(tidyverse)
library(magrittr)
library(knitr)
library(kableExtra)
library(tinytex)
library(gmodels)
library(readxl)
# library(MASS)
library(gtsummary)
library(caret)
library(leaps)
library(MASS)
library(predtools)
library(randomForest)
library(mice)
library(psfmi)
library(survival)
library(ranger)
library(ggplot2)
library(dplyr)
library(ggfortify)
library(survminer)
final_dataset <- read_csv("final_dataset.csv", show_col_types = F) %>%
mutate(addisons_disease = ifelse(`Random cortisol result` < 500 & (`Synacthen: 30 minute cortisol result`< 550 & `ACTH result`> 13.9), 1, 0)) #%>%
# dat <- final_dataset %>%
# dplyr::select(`Hospital folder number`,`Random cortisol result`, `ACTH sample drawn`, `ACTH result`, `Synacthen: 0 minute cortisol result`, `Synacthen: 30 minute cortisol result`, addisons_disease)
# write.csv(dat, 'outcome_dat.csv')
final_dataset<- final_dataset%>%
mutate(Ethnicity = as.factor(Ethnicity))
contrasts(final_dataset$Ethnicity) <-
contr.treatment(levels(final_dataset$Ethnicity),                                                    base = which(levels(final_dataset$Ethnicity) == 'Black African'))
table_1 <- final_dataset %>%
mutate(`log10 viral load` = log(`HIV viral load`, 10),
HIV_duration = as.numeric(as.Date(`Date of enrolment in study`, format='%m/%d/%Y') - as.Date(`HIV, when diagnosed`, format='%m/%d/%Y')),
gender = factor(Gender, labels = c('Females', 'Males'))) %>%
dplyr::select(`Age at enrolment`, Ethnicity, `Duration of current illness`, `Opportunistic infection present`, `log10 viral load`, `Total CD4 count...9`, Sodium, Potassium, Haemoglobin, `White cell count`, `Lymphocyte count`, Neutrophils, gender) %>%
tbl_summary(
missing = "no",
by = gender,
# statistic = list(all_continuous() ~ "{mean} ({sd})"),
label = list(`Total CD4 count...9` ~ 'Total CD4 count')
) %>%
add_p() %>%
add_n() %>%
modify_header(label = "Variable") %>% # update the column header
bold_labels()
# table_1
table_1
table_1
unlink("analysis_file_cache", recursive = TRUE)
knitr::opts_chunk$set(echo = TRUE)
knitr::opts_chunk$set(cache=TRUE)
knitr::opts_chunk$set(fig.pos = 'H')
knitr::opts_chunk$set(results = 'asis')
knitr::opts_chunk$set(echo = FALSE)
knitr::opts_chunk$set(message = FALSE)
library(tidyverse)
library(magrittr)
library(knitr)
library(kableExtra)
library(tinytex)
library(gmodels)
library(readxl)
# library(MASS)
library(gtsummary)
library(caret)
library(leaps)
library(MASS)
library(predtools)
library(randomForest)
library(mice)
library(psfmi)
library(survival)
library(ranger)
library(ggplot2)
library(dplyr)
library(ggfortify)
library(survminer)
table_1 <- final_dataset %>%
mutate(`log10 viral load` = log(`HIV viral load`, 10),
HIV_duration = as.numeric(as.Date(`Date of enrolment in study`, format='%m/%d/%Y') - as.Date(`HIV, when diagnosed`, format='%m/%d/%Y')),
gender = factor(Gender, labels = c('Females', 'Males'))) %>%
dplyr::select(`Age at enrolment`, Ethnicity, `Duration of current illness`, `Opportunistic infection present`, `log10 viral load`, `Total CD4 count...9`, Sodium, Potassium, Haemoglobin, `White cell count`, `Lymphocyte count`, Neutrophils, gender) %>%
tbl_summary(
missing = "no",
by = gender,
# statistic = list(all_continuous() ~ "{mean} ({sd})"),
label = list(`Total CD4 count...9` ~ 'Total CD4 count')
) %>%
add_p() %>%
add_n() %>%
modify_header(label = "Variable") %>% # update the column header
bold_labels()
table_1
save(table_1, 'table_1.doc')
table_1 <- final_dataset %>%
mutate(`log10 viral load` = log(`HIV viral load`, 10),
HIV_duration = as.numeric(as.Date(`Date of enrolment in study`, format='%m/%d/%Y') - as.Date(`HIV, when diagnosed`, format='%m/%d/%Y')),
gender = factor(Gender, labels = c('Females', 'Males'))) %>%
dplyr::select(`Age at enrolment`, Ethnicity, `Duration of current illness`, `Opportunistic infection present`, `log10 viral load`, `Total CD4 count...9`, Sodium, Potassium, Haemoglobin, `White cell count`, `Lymphocyte count`, Neutrophils, gender) %>%
tbl_summary(
missing = "no",
by = gender,
# statistic = list(all_continuous() ~ "{mean} ({sd})"),
label = list(`Total CD4 count...9` ~ 'Total CD4 count')
) %>%
add_p() %>%
add_n() %>%
modify_header(label = "Variable") %>% # update the column header
bold_labels()
save(table_1, 'table_1.doc')
13+2.5+5+2+4+3+5+2+3+2+5+2+2+2+7+5+5
unlink("analysis_file_tables_cache", recursive = TRUE)
12.5+4+6+2+5+4+3+4+3+2+5+2+2+2+7+6+6
(((1.96)^2) * 0.5)/(((.1)^2) *0.5)
(((1.96)^2) * 0.6)/(((.1)^2) *0.4)
(((1.96)^2) * 0.6)/(((.5)^2) *0.4)
(((1.96)^2) * 0.6)/(((.05)^2) *0.4)
(((1.96)^2) * 0.75)/(((.05)^2) *0.25)
(1.96^2 * ((.5 * (1-.5)) + (.5 * (1-.5))))/0.05^2
xtab <- as.table(rbind(
c(384, 536, 335),
c(951, 869, 438)
))
dimnames(xtab) <- list(
stone = c("yes", "no"),
age = c("30-39", "40-49", "50-59")
)
xtab
#>      age
#> stone 30-39 40-49 50-59
#>   yes   384   536   335
#>   no    951   869   438
# Compare the proportion of survived between groups
prop_trend_test(xtab)
(1.96^2 * o.85^2)/(0.1^2)
(1.96^2 * 0.85^2)/(0.1^2)
(1.96^2 * 0.85^2)/(0.05^2 * 20^2)
(1.96^2 * 0.85^2)/(0.05^2 * 2^2)
(1.96^2 * 2* 75^2)/(20^2)
