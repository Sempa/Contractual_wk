`Addisons disease`  = as.factor(ifelse(addisons_disease ==1, 'yes', ifelse(addisons_disease ==0, 'no', '')))) %>%
dplyr::select(`Age at enrolment`, gender, Ethnicity, `Duration of current illness`, `Opportunistic infection present`, `log10 viral load`, `Total CD4 count...9`, Sodium, Potassium, Haemoglobin, `White cell count`, `Lymphocyte count`, Neutrophils, `Addisons disease`) %>%
tbl_summary(#table_1,
missing = "no",
by = `Addisons disease`,
# statistic = list(all_continuous() ~ "{mean} ({sd})"),
digits = list(all_categorical() ~ c(0, 2)),
label = list(`Total CD4 count...9` ~ 'Total CD4 count')
) %>%
add_p() %>%
add_n() %>%
modify_header(label = "Variable") %>% # update the column header
bold_labels()
table_2
str(table3)
str(data.frame(table3))
str(as.data.frame(table3))
summary(table3)
summary(table_3)
str(as.data.frame(table_3))
final_dataset <- read_csv("final_dataset.csv", show_col_types = F) %>%
mutate(addisons_disease = ifelse(`Random cortisol result` < 500 & (`Synacthen: 30 minute cortisol result`< 550 & `ACTH result`> 13.9), 1, 0)) #%>%
str(final_dataset)
table(final_dataset$Ethnicity)
summary(final_dataset$Ethnicity)
View(final_dataset)
final_dataset <- read_csv("final_dataset.csv", show_col_types = F) %>%
mutate(addisons_disease = ifelse(`Random cortisol result` < 500 & (`Synacthen: 30 minute cortisol result`< 550 & `ACTH result`> 13.9), 1, 0)) %>%
mutate(ethnicity = ifelse(Ethnicity== 'Asian' | Ethnicity== 'Coloured' | Ethnicity== 'White', 'Other', Ethnicity))
table(final_dataset$ethnicity)
table_2 <- final_dataset %>%
mutate(Ethnicity = as.character(Ethnicity)) %>%
mutate(`log10 viral load` = log(`HIV viral load`, 10),
HIV_duration = as.numeric(as.Date(`Date of enrolment in study`, format='%m/%d/%Y') - as.Date(`HIV, when diagnosed`, format='%m/%d/%Y')),
gender = factor(Gender, labels = c('Females', 'Males')),
`Addisons disease`  = as.factor(ifelse(addisons_disease ==1, 'yes', ifelse(addisons_disease ==0, 'no', ''))),
Ethnicity = ifelse(Ethnicity== 'Asian' | Ethnicity== 'Coloured' | Ethnicity== 'White', 'Other', Ethnicity)) %>%
dplyr::select(`Age at enrolment`, gender, Ethnicity, `Duration of current illness`, `Opportunistic infection present`, `log10 viral load`, `Total CD4 count...9`, Sodium, Potassium, Haemoglobin, `White cell count`, `Lymphocyte count`, Neutrophils, `Addisons disease`) %>%
tbl_summary(#table_1,
missing = "no",
by = `Addisons disease`,
# statistic = list(all_continuous() ~ "{mean} ({sd})"),
digits = list(all_categorical() ~ c(0, 1)),
label = list(`Total CD4 count...9` ~ 'Total CD4 count')
) %>%
add_p() %>%
add_n() %>%
modify_header(label = "Variable") %>% # update the column header
bold_labels()
table_2
table_3 <- final_dataset %>%
left_join(table_mortality1, by = 'Hospital folder number') %>%
mutate(Ethnicity = as.character(Ethnicity)) %>%
mutate(`log10 viral load` = log(`HIV viral load`, 10),
HIV_duration = as.numeric(as.Date(`Date of enrolment in study`, format='%m/%d/%Y') - as.Date(`HIV, when diagnosed`, format='%m/%d/%Y')),
gender = factor(Gender, labels = c('Females', 'Males')),
`Addisons disease`  = as.factor(ifelse(addisons_disease ==1, 'yes', ifelse(addisons_disease ==0, 'no', ''))),
Ethnicity = ifelse(Ethnicity== 'Asian' | Ethnicity== 'Coloured' | Ethnicity== 'White', 'Other', Ethnicity),
`Total CD4 count` = `Total CD4 count...9`) %>%
dplyr::select(`Age at enrolment`, gender, Ethnicity, `Duration of current illness`, `log10 viral load`, `Total CD4 count`, Sodium, Potassium, Haemoglobin, `White cell count`, `Lymphocyte count`, Neutrophils, `Addisons disease`, mortality, ttdeath)#`Opportunistic infection present`,
#             by = `Addisons disease`,
#             # statistic = list(all_continuous() ~ "{mean} ({sd})"),
#             digits = list(all_categorical() ~ c(0, 2)),
#             label = list(`Total CD4 count...9` ~ 'Total CD4 count')
#             ) %>%
#   add_p() %>%
#   add_n() %>%
#   modify_header(label = "Variable") %>% # update the column header
#   bold_labels()
# table_3
tbl_uvregression(
table_3,
method=coxph,
y = Surv(time = ttdeath, event = mortality),
exponentiate = TRUE#,
# include = -ID
)
knitr::opts_chunk$set(echo = TRUE)
knitr::opts_chunk$set(cache=TRUE)
knitr::opts_chunk$set(fig.pos = 'H')
knitr::opts_chunk$set(results = 'asis')
knitr::opts_chunk$set(echo = FALSE)
knitr::opts_chunk$set(message = FALSE)
library(tidyverse)
library(magrittr)
library(knitr)
library(kableExtra)
library(tinytex)
library(gmodels)
library(readxl)
# library(MASS)
library(gtsummary)
library(caret)
library(leaps)
library(MASS)
library(predtools)
library(randomForest)
library(mice)
library(psfmi)
library(survival)
library(ranger)
library(ggplot2)
library(dplyr)
library(ggfortify)
library(survminer)
final_dataset <- read_csv("final_dataset.csv", show_col_types = F) %>%
mutate(addisons_disease = ifelse(`Random cortisol result` < 500 & (`Synacthen: 30 minute cortisol result`< 550 & `ACTH result`> 13.9), 1, 0)) #%>%
# dat <- final_dataset %>%
# dplyr::select(`Hospital folder number`,`Random cortisol result`, `ACTH sample drawn`, `ACTH result`, `Synacthen: 0 minute cortisol result`, `Synacthen: 30 minute cortisol result`, addisons_disease)
# write.csv(dat, 'outcome_dat.csv')
final_dataset<- final_dataset%>%
mutate(Ethnicity = as.factor(Ethnicity))
contrasts(final_dataset$Ethnicity) <-
contr.treatment(levels(final_dataset$Ethnicity),                                                    base = which(levels(final_dataset$Ethnicity) == 'Black African'))
table_mortality <- final_dataset %>%
dplyr::select(`Hospital folder number`, `3 followup_patientstatus`, `6 followup_patientstatus`, `12 followup_patientstatus`) %>%
pivot_longer(cols = c(`3 followup_patientstatus`, `6 followup_patientstatus`, `12 followup_patientstatus`),
names_to = 'col_num',
values_to = 'followup_patientstatus') %>%
dplyr::select(`Hospital folder number`, `followup_patientstatus`) %>%
group_by(`Hospital folder number`) %>%
mutate(mortality = ifelse(followup_patientstatus == 'Deceased --> EXIT form', 1,ifelse(followup_patientstatus == 'Alive', 0, 0))) %>%
dplyr::select(`Hospital folder number`, mortality)
table_mortality[is.na(table_mortality)] <- 0
table_mortality1 <- table_mortality %>%
group_by(`Hospital folder number`) %>%
mutate(mortality = max(mortality)) %>%
distinct(`Hospital folder number`, .keep_all = T)
time_to_death <- final_dataset%>%
dplyr::select(`Hospital folder number`, `3 followup_patientstatus`,
`6 followup_patientstatus`, `12 followup_patientstatus`
) %>%
mutate(flag1 = ifelse(`3 followup_patientstatus` == "Deceased --> EXIT form", 3, NA),
flag2 = ifelse(`6 followup_patientstatus` == "Deceased --> EXIT form", 6, NA),
flag3 = ifelse(`12 followup_patientstatus` == "Deceased --> EXIT form", 12, NA)) %>%
dplyr::select(`Hospital folder number`, flag1:flag3) %>%
pivot_longer(cols = c(flag1:flag3),
names_to = 'col_num',
values_to = 'time to death') %>%
dplyr::select(`Hospital folder number`, `time to death`) %>%
group_by(`Hospital folder number`) %>%
mutate(ttdeath = min(`time to death`, na.rm = T)) %>%
ungroup() %>%
mutate(ttdeath = ifelse(is.infinite(ttdeath), 12, ttdeath)) %>%
distinct(`Hospital folder number`, .keep_all = T) %>%
dplyr::select(`Hospital folder number`, ttdeath)
table_mortality1 <- table_mortality1 %>%
left_join(time_to_death, by = 'Hospital folder number')
table_3 <- final_dataset %>%
left_join(table_mortality1, by = 'Hospital folder number') %>%
mutate(Ethnicity = as.character(Ethnicity)) %>%
mutate(`log10 viral load` = log(`HIV viral load`, 10),
HIV_duration = as.numeric(as.Date(`Date of enrolment in study`, format='%m/%d/%Y') - as.Date(`HIV, when diagnosed`, format='%m/%d/%Y')),
gender = factor(Gender, labels = c('Females', 'Males')),
`Addisons disease`  = as.factor(ifelse(addisons_disease ==1, 'yes', ifelse(addisons_disease ==0, 'no', ''))),
Ethnicity = ifelse(Ethnicity== 'Asian' | Ethnicity== 'Coloured' | Ethnicity== 'White', 'Other', Ethnicity),
`Total CD4 count` = `Total CD4 count...9`) %>%
dplyr::select(`Age at enrolment`, gender, Ethnicity, `Duration of current illness`, `log10 viral load`, `Total CD4 count`, Sodium, Potassium, Haemoglobin, `White cell count`, `Lymphocyte count`, Neutrophils, `Addisons disease`, mortality, ttdeath)#`Opportunistic infection present`,
# mutate(addisons_disease_advanced_HIV = ifelse(addisons_disease==1 & `CD4 < 100`==1 & `Oral or inhaled steroids in the last three months`=='No', 1, 0)) %>%
# mutate(HIV_duration = as.numeric(as.Date(`Date of enrolment in study`, format='%m/%d/%Y') - as.Date(`HIV, when diagnosed`, format='%m/%d/%Y')),
#        enrol = as.Date(`Date of enrolment in study`, format = '%m/%d/%Y'),
#        diagnosed = as.Date(`HIV, when diagnosed`, format = '%m/%d/%Y')) %>%
# dplyr::select(`Hospital folder number`, Ethnicity, Gender, `Total CD4 count...9`, `Random cortisol result`, `Synacthen: 30 minute cortisol result`, `Synacthen: 0 minute cortisol result`, `ACTH result`, Neutrophils, `Lymphocyte count`, Haemoglobin, Sodium, Hypoglycaemia, `BP (systolic)`, `BP (diastolic)`, `Current tuberculosis`, `Duration of current illness`, HIV_duration, addisons_disease_advanced_HIV, mortality, ttdeath) %>%
# left_join(dt03, by = 'Hospital folder number')
# table_3 <- final_dataset %>%
#   mutate(`log10 viral load` = log(`HIV viral load`, 10),
#          HIV_duration = as.numeric(as.Date(`Date of enrolment in study`, format='%m/%d/%Y') - as.Date(`HIV, when diagnosed`, format='%m/%d/%Y')),
#          gender = factor(Gender, labels = c('Females', 'Males')),
#          `Addisons disease`  = as.factor(ifelse(addisons_disease ==1, 'yes', ifelse(addisons_disease ==0, 'no', '')))) %>%
#   dplyr::select(`Age at enrolment`, gender, Ethnicity, `Duration of current illness`, `Opportunistic infection present`, `log10 viral load`, `Total CD4 count...9`, Sodium, Potassium, Haemoglobin, `White cell count`, `Lymphocyte count`, Neutrophils, `Addisons disease`) #%>%
# tbl_summary(#table_1,
#             missing = "no",
#             by = `Addisons disease`,
#             # statistic = list(all_continuous() ~ "{mean} ({sd})"),
#             digits = list(all_categorical() ~ c(0, 2)),
#             label = list(`Total CD4 count...9` ~ 'Total CD4 count')
#             ) %>%
#   add_p() %>%
#   add_n() %>%
#   modify_header(label = "Variable") %>% # update the column header
#   bold_labels()
# table_3
tbl_uvregression(
table_3,
method=coxph,
y = Surv(time = ttdeath, event = mortality),
exponentiate = TRUE#,
# include = -ID
)
names(table_3)
my.variable.list <- names(table_3[, 1:12]) #model_dataset[,1:16,20:22])
My.stepwise::My.stepwise.coxph(Time = "ttdeath", Status = "mortality", variable.list = my.variable.list,
in.variable = c("addisons_disease_advanced_HIV"), data = model_dataset)
My.stepwise::My.stepwise.coxph(Time = "ttdeath", Status = "mortality", variable.list = my.variable.list,
in.variable = c("addisons_disease_advanced_HIV"), data = table_3)
My.stepwise::My.stepwise.coxph(Time = "ttdeath", Status = "mortality", variable.list = my.variable.list,
in.variable = c("Addisons disease"), data = table_3)
table_3 <- table_3 %>%
mutate(Addisons_disease = `Addisons disease`,
Log10_viralload = `log10 viral load`,
Age_at_enrolment = `Age at enrolment`,
Total_CD4_count = `Total CD4 count`,
White_cell_count = `White cell count`,
Lymphocyte_count = `Lymphocyte count`,
Duration_of_current_illness = `Duration of current illness`) %>%
dplyr::select(Age_at_enrolment, gender, Ethnicity, Duration_of_current_illness, Log10_viral_load, Total_CD4_count, Sodium, Potassium, Haemoglobin, White_cell_count, Lymphocyte_count, Neutrophils, Addisons_disease, mortality, ttdeath)
table_3 <- table_3 %>%
mutate(Addisons_disease = `Addisons disease`,
Log10_viralload = `log10 viral load`,
Age_at_enrolment = `Age at enrolment`,
Total_CD4_count = `Total CD4 count`,
White_cell_count = `White cell count`,
Lymphocyte_count = `Lymphocyte count`,
Duration_of_current_illness = `Duration of current illness`) %>%
dplyr::select(Age_at_enrolment, gender, Ethnicity, Duration_of_current_illness, Log10_viralload, Total_CD4_count, Sodium, Potassium, Haemoglobin, White_cell_count, Lymphocyte_count, Neutrophils, Addisons_disease, mortality, ttdeath)
my.variable.list <- names(table_3[, 1:12]) #model_dataset[,1:16,20:22])
My.stepwise::My.stepwise.coxph(Time = "ttdeath", Status = "mortality", variable.list = my.variable.list,
in.variable = c("Addisons_disease"), data = table_3)
table_3 <- table_3 %>%
mutate(Addisons_disease = as.factor(`Addisons disease`),
Log10_viralload = `log10 viral load`,
Age_at_enrolment = `Age at enrolment`,
Total_CD4_count = `Total CD4 count`,
White_cell_count = `White cell count`,
Lymphocyte_count = `Lymphocyte count`,
Duration_of_current_illness = `Duration of current illness`) %>%
dplyr::select(Age_at_enrolment, gender, Ethnicity, Duration_of_current_illness, Log10_viralload, Total_CD4_count, Sodium, Potassium, Haemoglobin, White_cell_count, Lymphocyte_count, Neutrophils, Addisons_disease, mortality, ttdeath)
table_mortality <- final_dataset %>%
dplyr::select(`Hospital folder number`, `3 followup_patientstatus`, `6 followup_patientstatus`, `12 followup_patientstatus`) %>%
pivot_longer(cols = c(`3 followup_patientstatus`, `6 followup_patientstatus`, `12 followup_patientstatus`),
names_to = 'col_num',
values_to = 'followup_patientstatus') %>%
dplyr::select(`Hospital folder number`, `followup_patientstatus`) %>%
group_by(`Hospital folder number`) %>%
mutate(mortality = ifelse(followup_patientstatus == 'Deceased --> EXIT form', 1,ifelse(followup_patientstatus == 'Alive', 0, 0))) %>%
dplyr::select(`Hospital folder number`, mortality)
table_mortality[is.na(table_mortality)] <- 0
table_mortality1 <- table_mortality %>%
group_by(`Hospital folder number`) %>%
mutate(mortality = max(mortality)) %>%
distinct(`Hospital folder number`, .keep_all = T)
time_to_death <- final_dataset%>%
dplyr::select(`Hospital folder number`, `3 followup_patientstatus`,
`6 followup_patientstatus`, `12 followup_patientstatus`
) %>%
mutate(flag1 = ifelse(`3 followup_patientstatus` == "Deceased --> EXIT form", 3, NA),
flag2 = ifelse(`6 followup_patientstatus` == "Deceased --> EXIT form", 6, NA),
flag3 = ifelse(`12 followup_patientstatus` == "Deceased --> EXIT form", 12, NA)) %>%
dplyr::select(`Hospital folder number`, flag1:flag3) %>%
pivot_longer(cols = c(flag1:flag3),
names_to = 'col_num',
values_to = 'time to death') %>%
dplyr::select(`Hospital folder number`, `time to death`) %>%
group_by(`Hospital folder number`) %>%
mutate(ttdeath = min(`time to death`, na.rm = T)) %>%
ungroup() %>%
mutate(ttdeath = ifelse(is.infinite(ttdeath), 12, ttdeath)) %>%
distinct(`Hospital folder number`, .keep_all = T) %>%
dplyr::select(`Hospital folder number`, ttdeath)
table_mortality1 <- table_mortality1 %>%
left_join(time_to_death, by = 'Hospital folder number')
table_3 <- final_dataset %>%
left_join(table_mortality1, by = 'Hospital folder number') %>%
mutate(Ethnicity = as.character(Ethnicity)) %>%
mutate(`log10 viral load` = log(`HIV viral load`, 10),
HIV_duration = as.numeric(as.Date(`Date of enrolment in study`, format='%m/%d/%Y') - as.Date(`HIV, when diagnosed`, format='%m/%d/%Y')),
gender = factor(Gender, labels = c('Females', 'Males')),
`Addisons disease`  = as.factor(ifelse(addisons_disease ==1, 'yes', ifelse(addisons_disease ==0, 'no', ''))),
Ethnicity = ifelse(Ethnicity== 'Asian' | Ethnicity== 'Coloured' | Ethnicity== 'White', 'Other', Ethnicity),
`Total CD4 count` = `Total CD4 count...9`) %>%
dplyr::select(`Age at enrolment`, gender, Ethnicity, `Duration of current illness`, `log10 viral load`, `Total CD4 count`, Sodium, Potassium, Haemoglobin, `White cell count`, `Lymphocyte count`, Neutrophils, `Addisons disease`, mortality, ttdeath)#`Opportunistic infection present`,
table_3_updated <- table_3 %>%
mutate(Addisons_disease = as.factor(`Addisons disease`),
Log10_viralload = `log10 viral load`,
Age_at_enrolment = `Age at enrolment`,
Total_CD4_count = `Total CD4 count`,
White_cell_count = `White cell count`,
Lymphocyte_count = `Lymphocyte count`,
Duration_of_current_illness = `Duration of current illness`) %>%
dplyr::select(Age_at_enrolment, gender, Ethnicity, Duration_of_current_illness, Log10_viralload, Total_CD4_count, Sodium, Potassium, Haemoglobin, White_cell_count, Lymphocyte_count, Neutrophils, Addisons_disease, mortality, ttdeath)
my.variable.list <- names(table_3[, 1:12]) #model_dataset[,1:16,20:22])
My.stepwise::My.stepwise.coxph(Time = "ttdeath", Status = "mortality", variable.list = my.variable.list,
in.variable = c("Addisons_disease"), data = table_3_updated)
my.variable.list <- names(table_3_updated[, 1:12]) #model_dataset[,1:16,20:22])
My.stepwise::My.stepwise.coxph(Time = "ttdeath", Status = "mortality", variable.list = my.variable.list,
in.variable = c("Addisons_disease"), data = table_3_updated)
model1 <- survival::coxph(Surv(ttdeath, mortality) ~ Addisons_disease + Age_at_enrolment+ gender+ Ethnicity#ACTH.result +
# `Synacthen..30.minute.cortisol.result` + `Synacthen..0.minute.cortisol.result` + `BP..diastolic.` + `BP..systolic.` + Gender,
data = model_dataset)
model1 <- survival::coxph(Surv(ttdeath, mortality) ~ Addisons_disease + Age_at_enrolment+ gender+ Ethnicity,#ACTH.result +
# `Synacthen..30.minute.cortisol.result` + `Synacthen..0.minute.cortisol.result` + `BP..diastolic.` + `BP..systolic.` + Gender,
data = model_dataset)
model1 <- survival::coxph(Surv(ttdeath, mortality) ~ Addisons_disease + Age_at_enrolment+ gender+ Ethnicity,#ACTH.result +
# `Synacthen..30.minute.cortisol.result` + `Synacthen..0.minute.cortisol.result` + `BP..diastolic.` + `BP..systolic.` + Gender,
data = table_3_updated)
summary(model1)
My.stepwise::My.stepwise.coxph(Time = "ttdeath", Status = "mortality", variable.list = my.variable.list,
in.variable = c("Addisons_disease"), data = table_3_updated)
My.stepwise::My.stepwise.coxph(Time = "ttdeath", Status = "mortality", variable.list = my.variable.list,
in.variable = c("Addisons_disease"), data = table_3_updated)
model1 <- survival::coxph(Surv(ttdeath, mortality) ~ Addisons_disease, #+ Age_at_enrolment+ gender+ Ethnicity,#ACTH.result +
# `Synacthen..30.minute.cortisol.result` + `Synacthen..0.minute.cortisol.result` + `BP..diastolic.` + `BP..systolic.` + Gender,
data = table_3_updated)
summary(model1)
#             by = `Addisons disease`,
#             # statistic = list(all_continuous() ~ "{mean} ({sd})"),
#             digits = list(all_categorical() ~ c(0, 2)),
#             label = list(`Total CD4 count...9` ~ 'Total CD4 count')
#             ) %>%
#   add_p() %>%
#   add_n() %>%
#   modify_header(label = "Variable") %>% # update the column header
#   bold_labels()
# table_3
tbl_uvregression(
table_3,
method=coxph,
y = Surv(time = ttdeath, event = mortality),
exponentiate = TRUE#,
# include = -ID
)
My.stepwise::My.stepwise.coxph(Time = "ttdeath", Status = "mortality", variable.list = my.variable.list,
in.variable = c("Addisons_disease"), data = table_3_updated, sle = 0.20, sls = 0.20)
My.stepwise::My.stepwise.coxph(Time = "ttdeath", Status = "mortality", variable.list = my.variable.list,
data = table_3_updated, sle = 0.20, sls = 0.20)
My.stepwise::My.stepwise.coxph(Time = "ttdeath", Status = "mortality", variable.list = my.variable.list,
data = table_3_updated, sle = 0.50, sls = 0.50)
table_3_updated <- table_3 %>%
mutate(Ethnicity = as.numeric(as.factor(Ethnicity)),
Gender = as.numeric(as.factor(Gender)),
Addisons_disease = as.numeric(as.factor(`Addisons disease`)),
Log10_viralload = `log10 viral load`,
Age_at_enrolment = `Age at enrolment`,
Total_CD4_count = `Total CD4 count`,
White_cell_count = `White cell count`,
Lymphocyte_count = `Lymphocyte count`,
Duration_of_current_illness = `Duration of current illness`) %>%
dplyr::select(Age_at_enrolment, gender, Ethnicity, Duration_of_current_illness, Log10_viralload, Total_CD4_count, Sodium, Potassium, Haemoglobin, White_cell_count, Lymphocyte_count, Neutrophils, Addisons_disease, mortality, ttdeath)
table_3_updated <- table_3 %>%
mutate(Ethnicity = as.numeric(as.factor(Ethnicity)),
gender = as.numeric(as.factor(Gender)),
Addisons_disease = as.numeric(as.factor(`Addisons disease`)),
Log10_viralload = `log10 viral load`,
Age_at_enrolment = `Age at enrolment`,
Total_CD4_count = `Total CD4 count`,
White_cell_count = `White cell count`,
Lymphocyte_count = `Lymphocyte count`,
Duration_of_current_illness = `Duration of current illness`) %>%
dplyr::select(Age_at_enrolment, gender, Ethnicity, Duration_of_current_illness, Log10_viralload, Total_CD4_count, Sodium, Potassium, Haemoglobin, White_cell_count, Lymphocyte_count, Neutrophils, Addisons_disease, mortality, ttdeath)
table_3_updated <- table_3 %>%
mutate(Ethnicity = as.numeric(as.factor(Ethnicity)),
gender = as.numeric(as.factor(gender)),
Addisons_disease = as.numeric(as.factor(`Addisons disease`)),
Log10_viralload = `log10 viral load`,
Age_at_enrolment = `Age at enrolment`,
Total_CD4_count = `Total CD4 count`,
White_cell_count = `White cell count`,
Lymphocyte_count = `Lymphocyte count`,
Duration_of_current_illness = `Duration of current illness`) %>%
dplyr::select(Age_at_enrolment, gender, Ethnicity, Duration_of_current_illness, Log10_viralload, Total_CD4_count, Sodium, Potassium, Haemoglobin, White_cell_count, Lymphocyte_count, Neutrophils, Addisons_disease, mortality, ttdeath)
nr_imputations <- 5
imputedData <- mice::mice(data = data.frame(table_3_updated), m = nr_imputations, maxit = 20, meth = 'pmm', seed = 33)
completeData <- complete(imputedData, 2)
model_dataset <- completeData
model_dataset[, 1:12])
model_dataset[, 1:12]
names(model_dataset[, 1:12])
names
names(model_dataset)
My.stepwise::My.stepwise.coxph(Time = "ttdeath", Status = "mortality", variable.list = my.variable.list,
in.variable = c("Addisons_disease"), data = table_3_updated, sle = 0.20, sls = 0.20)
My.stepwise::My.stepwise.coxph(Time = "ttdeath", Status = "mortality", variable.list = my.variable.list,
data = table_3_updated, sle = 0.20, sls = 0.20)
My.stepwise::My.stepwise.coxph(Time = "ttdeath", Status = "mortality", variable.list = my.variable.list,
in.variable = c("Addisons_disease"), data = model_dataset, sle = 0.20, sls = 0.20)
table(table_3_updated$mortality)
model1 <- survival::coxph(Surv(ttdeath, mortality) ~ Addisons_disease, + Log10_viralload + Neutrophils + Lymphocyte_count + Potassium + gender, data = model_dataset)
summary(model1)
model1 <- survival::coxph(Surv(ttdeath, mortality) ~ Addisons_disease, + Log10_viralload + Neutrophils + Lymphocyte_count + Potassium + gender, data = model_dataset)
summary(model1)
model1
model1 <- survival::coxph(Surv(ttdeath, mortality) ~ Addisons_disease + Log10_viralload + Neutrophils + Lymphocyte_count + Potassium + gender, data = model_dataset)
summary(model1)
table_3 <- final_dataset %>%
left_join(table_mortality1, by = 'Hospital folder number') %>%
mutate(Ethnicity = as.character(Ethnicity)) %>%
mutate(`log10 viral load` = log(`HIV viral load`, 10),
HIV_duration = as.numeric(as.Date(`Date of enrolment in study`, format='%m/%d/%Y') - as.Date(`HIV, when diagnosed`, format='%m/%d/%Y')),
gender = factor(Gender, labels = c('Females', 'Males')),
`Addisons disease`  = as.factor(ifelse(addisons_disease ==1, 'yes', ifelse(addisons_disease ==0, 'no', ''))),
Ethnicity = ifelse(Ethnicity== 'Asian' | Ethnicity== 'Coloured' | Ethnicity== 'White', 'Other', Ethnicity),
`Total CD4 count` = `Total CD4 count...9`) %>%
dplyr::select(`Age at enrolment`, gender, Ethnicity, `Duration of current illness`, `log10 viral load`, `Total CD4 count`, Sodium, Potassium, Haemoglobin, `White cell count`, `Lymphocyte count`, Neutrophils, `Addisons disease`, mortality, ttdeath) %>%
mutate(Ethnicity = as.numeric(as.factor(Ethnicity)),
gender = as.numeric(as.factor(gender)),
Addisons_disease = as.numeric(as.factor(`Addisons disease`)),
Log10_viralload = `log10 viral load`,
Age_at_enrolment = `Age at enrolment`,
Total_CD4_count = `Total CD4 count`,
White_cell_count = `White cell count`,
Lymphocyte_count = `Lymphocyte count`,
Duration_of_current_illness = `Duration of current illness`) %>%
dplyr::select(Age_at_enrolment, gender, Ethnicity, Duration_of_current_illness, Log10_viralload, Total_CD4_count, Sodium, Potassium, Haemoglobin, White_cell_count, Lymphocyte_count, Neutrophils, Addisons_disease, mortality, ttdeath)
nr_imputations <- 5
imputedData <- mice::mice(data = data.frame(table_3), m = nr_imputations, maxit = 20, meth = 'pmm', seed = 33)
completeData <- complete(imputedData, 2)
model_dataset <- completeData#`Opportunistic infection present`,
#             by = `Addisons disease`,
#             # statistic = list(all_continuous() ~ "{mean} ({sd})"),
#             digits = list(all_categorical() ~ c(0, 2)),
#             label = list(`Total CD4 count...9` ~ 'Total CD4 count')
#             ) %>%
#   add_p() %>%
#   add_n() %>%
#   modify_header(label = "Variable") %>% # update the column header
#   bold_labels()
# table_3
tbl_uvregression(
model_dataset, #table_3,
method=coxph,
y = Surv(time = ttdeath, event = mortality),
exponentiate = TRUE#,
# include = -ID
)
my.variable.list <- names(model_dataset[, 1:12]) #model_dataset[,1:16,20:22])
My.stepwise::My.stepwise.coxph(Time = "ttdeath", Status = "mortality", variable.list = my.variable.list,
in.variable = c("Addisons_disease"), data = model_dataset, sle = 0.20, sls = 0.20)
model1 <- survival::coxph(Surv(ttdeath, mortality) ~ Addisons_disease + Log10_viralload + Neutrophils + Lymphocyte_count + Potassium + gender, data = model_dataset)
summary(model1)
coef(model1)
confint(model1)
mv_table <- #data.frame(
cbind(exp(cbind(coef(model1),confint(model1))), p_value = round(summary(model1)$coefficients[,5], 4))
#)
mv_table%>%
kable(caption = "Final MV table") %>%
kable_paper("hover", full_width = F) %>%
kable_classic(full_width = F, html_font = "Arial")%>%
kable_styling(latex_options = "HOLD_position")
unlink("analysis_file_tables_cache", recursive = TRUE)
unlink("analysis_file_tables_cache", recursive = TRUE)
imputedData <- suppressPackageStartupMessagesmice::mice(data = data.frame(table_3), m = nr_imputations, maxit = 20, meth = 'pmm', seed = 33))
imputedData <- suppressPackageStartupMessages(mice::mice(data = data.frame(table_3), m = nr_imputations, maxit = 20, meth = 'pmm', seed = 33))
unlink("analysis_file_tables_cache", recursive = TRUE)
#)
mv_table%>%
theme_zebra() %>%
autofit()
library(magrittr)
library(flextable)
#)
mv_table%>%
theme_zebra() %>%
autofit()
#)
flextable(mv_table)%>%
theme_zebra() %>%
autofit()
#)
flextable(data.frame(mv_table))%>%
theme_zebra() %>%
autofit()
#)
final_table <- data.frame(exp(ci(model1$finalModel)[2:4,1:3])) %>%
mutate(Variable = c("Addison's disease advanced HIV", "Log10 Viral load", 'Neutrophils', 'Lymphocyte count', 'Potassium', 'gender')) %>%
dplyr::select(Variable, Estimate, CI.lower, CI.upper)
model1 <- survival::coxph(Surv(ttdeath, mortality) ~ Addisons_disease + Log10_viralload + Neutrophils + Lymphocyte_count + Potassium + gender, data = model_dataset)
#)
final_table <- data.frame(exp(ci(model1$finalModel)[2:4,1:3])) %>%
mutate(Variable = c("Addison's disease advanced HIV", "Log10 Viral load", 'Neutrophils', 'Lymphocyte count', 'Potassium', 'gender')) %>%
dplyr::select(Variable, Estimate, CI.lower, CI.upper)
exp(ci(model1$finalModel)[2:4,1:3])
coef(model1)
confint(model1)
exp(model1)
cbind(coef(model1), confint(model1))
cbind(exp(coef(model1)), exp(confint(model1)))
#)
final_table <- data.frame(cbind(exp(coef(model1)), exp(confint(model1)))) %>%
mutate(Variable = c("Addison's disease advanced HIV", "Log10 Viral load", 'Neutrophils', 'Lymphocyte count', 'Potassium', 'gender')) %>%
dplyr::select(Variable, Estimate, CI.lower, CI.upper)
final_table <- data.frame(cbind(exp(coef(model1)), exp(confint(model1)))) %>%
mutate(Variable = c("Addison's disease advanced HIV", "Log10 Viral load", 'Neutrophils', 'Lymphocyte count', 'Potassium', 'gender'))
names(final_dataset)
names(final_table)
View(final_table)
final_table <- data.frame(cbind(exp(coef(model1)), exp(confint(model1)))) %>%
mutate(Variable = c("Addison's disease advanced HIV", "Log10 Viral load", 'Neutrophils', 'Lymphocyte count', 'Potassium', 'gender'), Adj.HR = V1)
View(final_table)
final_table <- data.frame(cbind(exp(coef(model1)), exp(confint(model1)))) %>%
mutate(Variable = c("Addison's disease advanced HIV", "Log10 Viral load", 'Neutrophils', 'Lymphocyte count', 'Potassium', 'gender'), Adj.HR = V1, `95%CI` = paste('(', `X2.5..`, ', ', `X97.5..`, ')', sep = ''))
View(final_table)
summary(model1)$coefficients[, 5]
final_table <- data.frame(cbind(exp(coef(model1)), exp(confint(model1)), summary(model1)$coefficients[, 5])) %>%
mutate(Variable = c("Addison's disease advanced HIV", "Log10 Viral load", 'Neutrophils', 'Lymphocyte count', 'Potassium', 'gender'), Adj.HR = round(V1,3), `95%CI` = paste('(', round(`X2.5..`, 5), ', ', round(`X97.5..`, 5), ')', sep = ''))
View(final_table)
summary(model1)
#)
final_table <- data.frame(cbind(exp(coef(model1)), exp(confint(model1)), summary(model1)$coefficients[, 5])) %>%
mutate(Variable = c("Addison's disease advanced HIV", "Log10 Viral load", 'Neutrophils', 'Lymphocyte count', 'Potassium', 'gender'), Adj.HR = round(V1,3), `95%CI` = paste('(', round(`X2.5..`, 5), ', ', round(`X97.5..`, 5), ')', sep = ''), `P value` = V4) %>%
dplyr::select(Variable, Adj.HR, `95%CI`, `P value`)
row.names(final_table) <- 1:length(final_table$Variable)
write.csv(final_table, 'final_table_updated.csv')
View(final_table)
#)
final_table <- data.frame(cbind(exp(coef(model1)), exp(confint(model1)), summary(model1)$coefficients[, 5])) %>%
mutate(Variable = c("Addison's disease", "Log10 Viral load", 'Neutrophils', 'Lymphocyte count', 'Potassium', 'gender'), Adj.HR = round(V1,3), `95%CI` = paste('(', round(`X2.5..`, 5), ', ', round(`X97.5..`, 5), ')', sep = ''), `P value` = V4) %>%
dplyr::select(Variable, Adj.HR, `95%CI`, `P value`)
row.names(final_table) <- 1:length(final_table$Variable)
write.csv(final_table, 'final_table_updated.csv')
unlink("analysis_file_tables_cache", recursive = TRUE)
unlink("analysis_file_tables_cache", recursive = TRUE)
